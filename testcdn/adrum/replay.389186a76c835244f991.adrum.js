"use strict";(self.webpackChunk_appd_js_agent_client=self.webpackChunk_appd_js_agent_client||[]).push([[630],{7144:function(e,t,n){n.r(t),n.d(t,{SessionReplayModule:function(){return Rn}});var s=n(3012),i=n(7444),o=n(3589),r=n(3596),a=n(7494),d=n(2512);class c{constructor(){this.listeners={},this.addEventListener=(e,t)=>{var n;const s=null!==(n=this.listeners[e])&&void 0!==n?n:[];s.push(t),this.listeners[e]=s},this.emit=(e,...t)=>{const n=this.listeners[e];n&&n.forEach((e=>{e(...t)}))},this.removeEventListener=(e,t)=>{const n=this.listeners[e];if(n){const s=n.indexOf(t);-1===s?i.R.error(`Trying to remove not existing listener of type '${String(e)}'`):n.splice(s,1)}}}}var u,l=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};class h{constructor(){this.isTaskQueueRunning=!1,this.taskQueue=[],this.postTask=(e,t)=>l(this,void 0,void 0,(function*(){return new Promise(((n,s)=>{this.taskQueue.push({reject:s,resolve:n,taskFunction:t,taskName:e}),this.isTaskQueueRunning||(this.isTaskQueueRunning=!0,this.runTaskQueue())}))})),this.runTaskQueue=()=>l(this,void 0,void 0,(function*(){if(0!==this.taskQueue.length){for(;this.taskQueue.length>0;){const e=this.taskQueue.shift();if(void 0===e)break;const t=e.taskFunction();if(t)try{const n=yield u.processTaskIterator(t);e.resolve(n)}catch(t){i.R.error(`Task ${e.taskName} failed`,t),e.reject(t)}else e.resolve()}this.isTaskQueueRunning=!1}else this.isTaskQueueRunning=!1}))}}u=h,h.processTaskIterator=e=>l(void 0,void 0,void 0,(function*(){let t=!1;for(;!t;)t=yield new Promise(((t,n)=>{requestIdleCallback((s=>{for(;s.timeRemaining()>1;)try{const n=e.next();if(n.done)return void t(n)}catch(e){return void n(e)}t(!1)}),{timeout:100})}));return t.value}));var p,v=new h;!function(e){e.ADOPTED_STYLESHEET="adopted-stylesheet",e.ANIMATION="animation",e.BLUR="blur",e.CONSOLE="console",e.DOM_SNAPSHOT="dom-snapshot",e.ELEMENT_ANIMATE="element-animate",e.ERROR="error",e.FOCUS="focus",e.INPUT="input",e.CLICK="click",e.MOUSE_MOVE="mouse-move",e.NODE_MUTATION="node-mutation",e.PULSE="pulse",e.POPOVER="popover",e.RAGE_CLICK="rage-click",e.RESIZE="resize",e.SCROLL="scroll",e.SELECTION="selection",e.STOP="stop",e.TITLE="title",e.TOUCH_MOVE="touch-move",e.STYLESHEET_MUTATION="stylesheet-mutation",e.URL="url",e.URL_SPAN="url-span",e.VISUAL_VIEWPORT="visual-viewport"}(p||(p={}));var g=n(5391);const f=(e,t,n)=>{if(!(t in e))return;const s=e[t];e[t]=function(...e){return n(s.bind(this)).call(this,...e)}},m=(e,t,n)=>{if(!(t in e))return;const s=Object.getOwnPropertyDescriptor(e,t);s&&Object.defineProperty(e,t,n(s))};class S extends Error{sourceStart;sourceEnd;parserState;constructor(e,t,n,s){super(e),this.name="ParseError",this.sourceStart=t,this.sourceEnd=n,this.parserState=s}}class y{cursor=0;source="";codePointSource=[];representationIndices=[-1];length=0;representationStart=0;representationEnd=-1;constructor(e){this.source=e;{let t=-1,n="";for(n of e)t+=n.length,this.codePointSource.push(n.codePointAt(0)),this.representationIndices.push(t)}this.length=this.codePointSource.length}advanceCodePoint(e=1){this.cursor=this.cursor+e,this.representationEnd=this.representationIndices[this.cursor]}readCodePoint(e=1){const t=this.codePointSource[this.cursor];return void 0!==t&&(this.cursor=this.cursor+e,this.representationEnd=this.representationIndices[this.cursor],t)}unreadCodePoint(e=1){this.cursor=this.cursor-e,this.representationEnd=this.representationIndices[this.cursor]}resetRepresentation(){this.representationStart=this.representationIndices[this.cursor]+1,this.representationEnd=-1}}const E=39,w=42,b=8,I=13,P=9,C=58,R=44,M=64,N=127,T=33,O=12,k=46,x=62,A=45,W=31,L=69,D=101,B=123,j=40,z=91,U=60,F=10,V=11,_=95,Q=1114111,$=0,X=35,Y=37,q=43,H=34,K=65533,G=92,J=125,Z=41,ee=93,te=59,ne=14,se=47,ie=32,oe=117,re=85,ae=114,de=82,ce=108,ue=76,le=63,he=48,pe=70;function ve(e){return e.codePointSource[e.cursor]===U&&e.codePointSource[e.cursor+1]===T&&e.codePointSource[e.cursor+2]===A&&e.codePointSource[e.cursor+3]===A}function ge(e){return e>=48&&e<=57}function fe(e){return ge(e)||e>=97&&e<=102||e>=65&&e<=70}function me(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return 183===e||8204===e||8205===e||8255===e||8256===e||8204===e||192<=e&&e<=214||216<=e&&e<=246||248<=e&&e<=893||895<=e&&e<=8191||8304<=e&&e<=8591||11264<=e&&e<=12271||12289<=e&&e<=55295||63744<=e&&e<=64975||65008<=e&&e<=65533||e>=65536}(e)||e===_}function Se(e){return me(e)||ge(e)||e===A}function ye(e){return 10===e||13===e||12===e}function Ee(e){return 32===e||10===e||9===e||13===e||12===e}function we(e){return e.codePointSource[e.cursor]===G&&!ye(e.codePointSource[e.cursor+1])}function be(e,t){return t.codePointSource[t.cursor]===A?t.codePointSource[t.cursor+1]===A||!!me(t.codePointSource[t.cursor+1])||t.codePointSource[t.cursor+1]===G&&!ye(t.codePointSource[t.cursor+2]):!!me(t.codePointSource[t.cursor])||we(t)}function Ie(e){return e.codePointSource[e.cursor]===q||e.codePointSource[e.cursor]===A?!!ge(e.codePointSource[e.cursor+1])||e.codePointSource[e.cursor+1]===k&&ge(e.codePointSource[e.cursor+2]):e.codePointSource[e.cursor]===k?ge(e.codePointSource[e.cursor+1]):ge(e.codePointSource[e.cursor])}function Pe(e){return e.codePointSource[e.cursor]===se&&e.codePointSource[e.cursor+1]===w}function Ce(e){return e.codePointSource[e.cursor]===A&&e.codePointSource[e.cursor+1]===A&&e.codePointSource[e.cursor+2]===x}var Re,Me,Ne;function Te(e,t){for(t.advanceCodePoint(2);;){const n=t.readCodePoint();if(!1===n){e.onParseError(new S("Unexpected EOF while consuming a comment.",t.representationStart,t.representationEnd,["4.3.2. Consume comments","Unexpected EOF"]));break}if(n===w&&void 0!==t.codePointSource[t.cursor]&&t.codePointSource[t.cursor]===se){t.advanceCodePoint();break}}return[Re.Comment,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0]}function Oe(e,t){const n=t.readCodePoint();if(!1===n)return e.onParseError(new S("Unexpected EOF while consuming an escaped code point.",t.representationStart,t.representationEnd,["4.3.7. Consume an escaped code point","Unexpected EOF"])),K;if(fe(n)){const e=[n];for(;void 0!==t.codePointSource[t.cursor]&&fe(t.codePointSource[t.cursor])&&e.length<6;)e.push(t.codePointSource[t.cursor]),t.advanceCodePoint();Ee(t.codePointSource[t.cursor])&&t.advanceCodePoint();const i=parseInt(String.fromCodePoint(...e),16);return 0===i||(s=i)>=55296&&s<=57343||i>Q?K:i}var s;return n}function ke(e,t){const n=[];for(;;)if(Se(t.codePointSource[t.cursor]))n.push(t.codePointSource[t.cursor]),t.advanceCodePoint();else{if(!we(t))return n;t.advanceCodePoint(),n.push(Oe(e,t))}}function xe(e,t){let n;{const e=t.codePointSource[t.cursor];e===A?n="-":e===q&&(n="+")}const s=function(e,t){let n=Me.Integer;for(t.codePointSource[t.cursor]!==q&&t.codePointSource[t.cursor]!==A||t.advanceCodePoint();ge(t.codePointSource[t.cursor]);)t.advanceCodePoint();if(t.codePointSource[t.cursor]===k&&ge(t.codePointSource[t.cursor+1]))for(t.advanceCodePoint(2),n=Me.Number;ge(t.codePointSource[t.cursor]);)t.advanceCodePoint();if(t.codePointSource[t.cursor]===D||t.codePointSource[t.cursor]===L){if(ge(t.codePointSource[t.cursor+1]))t.advanceCodePoint(2);else{if(t.codePointSource[t.cursor+1]!==A&&t.codePointSource[t.cursor+1]!==q||!ge(t.codePointSource[t.cursor+2]))return n;t.advanceCodePoint(3)}for(n=Me.Number;ge(t.codePointSource[t.cursor]);)t.advanceCodePoint()}return n}(0,t),i=parseFloat(t.source.slice(t.representationStart,t.representationEnd+1));if(be(0,t)){const o=ke(e,t);return[Re.Dimension,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:i,signCharacter:n,type:s,unit:String.fromCodePoint(...o)}]}return t.codePointSource[t.cursor]===Y?(t.advanceCodePoint(),[Re.Percentage,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:i,signCharacter:n}]):[Re.Number,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:i,signCharacter:n,type:s}]}function Ae(e,t){for(;;){if(void 0===t.codePointSource[t.cursor])return;if(t.codePointSource[t.cursor]===Z)return void t.advanceCodePoint();we(t)?(t.advanceCodePoint(),Oe(e,t)):t.advanceCodePoint()}}function We(e,t){for(;Ee(t.codePointSource[t.cursor]);)t.advanceCodePoint();let n="";for(;;){if(void 0===t.codePointSource[t.cursor])return e.onParseError(new S("Unexpected EOF while consuming a url token.",t.representationStart,t.representationEnd,["4.3.6. Consume a url token","Unexpected EOF"])),[Re.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:n}];if(t.codePointSource[t.cursor]===Z)return t.advanceCodePoint(),[Re.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:n}];if(Ee(t.codePointSource[t.cursor])){for(t.advanceCodePoint();Ee(t.codePointSource[t.cursor]);)t.advanceCodePoint();return void 0===t.codePointSource[t.cursor]?(e.onParseError(new S("Unexpected EOF while consuming a url token.",t.representationStart,t.representationEnd,["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"])),[Re.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:n}]):t.codePointSource[t.cursor]===Z?(t.advanceCodePoint(),[Re.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:n}]):(Ae(e,t),[Re.BadURL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0])}if(t.codePointSource[t.cursor]===H||t.codePointSource[t.cursor]===E||t.codePointSource[t.cursor]===j||(s=t.codePointSource[t.cursor])===V||s===N||$<=s&&s<=b||ne<=s&&s<=W)return Ae(e,t),e.onParseError(new S("Unexpected character while consuming a url token.",t.representationStart,t.representationEnd,["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"])),[Re.BadURL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0];if(t.codePointSource[t.cursor]===G){if(we(t)){t.advanceCodePoint(),n+=String.fromCodePoint(Oe(e,t));continue}return Ae(e,t),e.onParseError(new S("Invalid escape sequence while consuming a url token.",t.representationStart,t.representationEnd,["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"])),[Re.BadURL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0]}n+=String.fromCodePoint(t.codePointSource[t.cursor]),t.advanceCodePoint()}var s}function Le(e,t){const n=ke(e,t);if(t.codePointSource[t.cursor]!==j)return[Re.Ident,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:String.fromCodePoint(...n)}];if(function(e){return!(3!==e.length||e[0]!==oe&&e[0]!==re||e[1]!==ae&&e[1]!==de||e[2]!==ce&&e[2]!==ue)}(n)){t.advanceCodePoint();let s=0;for(;;){const e=Ee(t.codePointSource[t.cursor]),i=Ee(t.codePointSource[t.cursor+1]);if(e&&i){s+=1,t.advanceCodePoint(1);continue}const o=e?t.codePointSource[t.cursor+1]:t.codePointSource[t.cursor];if(o===H||o===E)return s>0&&t.unreadCodePoint(s),[Re.Function,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:String.fromCodePoint(...n)}];break}return We(e,t)}return t.advanceCodePoint(),[Re.Function,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:String.fromCodePoint(...n)}]}function De(e,t){const n=e.css.valueOf(),s=e.unicodeRangesAllowed??!1,i=new y(n),o={onParseError:t?.onParseError??Be};return{nextToken:function(){i.resetRepresentation();const e=i.codePointSource[i.cursor];if(void 0===e)return[Re.EOF,"",-1,-1,void 0];if(e===se&&Pe(i))return Te(o,i);if(s&&(e===oe||e===re)&&function(e){return!(e.codePointSource[e.cursor]!==oe&&e.codePointSource[e.cursor]!==re||e.codePointSource[e.cursor+1]!==q||e.codePointSource[e.cursor+2]!==le&&!fe(e.codePointSource[e.cursor+2]))}(i))return function(e,t){t.advanceCodePoint(2);const n=[],s=[];for(;void 0!==t.codePointSource[t.cursor]&&n.length<6&&fe(t.codePointSource[t.cursor]);)n.push(t.codePointSource[t.cursor]),t.advanceCodePoint();for(;void 0!==t.codePointSource[t.cursor]&&n.length<6&&t.codePointSource[t.cursor]===le;)0===s.length&&s.push(...n),n.push(he),s.push(pe),t.advanceCodePoint();if(!s.length&&t.codePointSource[t.cursor]===A&&fe(t.codePointSource[t.cursor+1]))for(t.advanceCodePoint();void 0!==t.codePointSource[t.cursor]&&s.length<6&&fe(t.codePointSource[t.cursor]);)s.push(t.codePointSource[t.cursor]),t.advanceCodePoint();if(!s.length){const e=parseInt(String.fromCodePoint(...n),16);return[Re.UnicodeRange,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{startOfRange:e,endOfRange:e}]}const i=parseInt(String.fromCodePoint(...n),16),o=parseInt(String.fromCodePoint(...s),16);return[Re.UnicodeRange,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{startOfRange:i,endOfRange:o}]}(0,i);if(me(e))return Le(o,i);if(ge(e))return xe(o,i);switch(e){case R:return i.advanceCodePoint(),[Re.Comma,",",i.representationStart,i.representationEnd,void 0];case C:return i.advanceCodePoint(),[Re.Colon,":",i.representationStart,i.representationEnd,void 0];case te:return i.advanceCodePoint(),[Re.Semicolon,";",i.representationStart,i.representationEnd,void 0];case j:return i.advanceCodePoint(),[Re.OpenParen,"(",i.representationStart,i.representationEnd,void 0];case Z:return i.advanceCodePoint(),[Re.CloseParen,")",i.representationStart,i.representationEnd,void 0];case z:return i.advanceCodePoint(),[Re.OpenSquare,"[",i.representationStart,i.representationEnd,void 0];case ee:return i.advanceCodePoint(),[Re.CloseSquare,"]",i.representationStart,i.representationEnd,void 0];case B:return i.advanceCodePoint(),[Re.OpenCurly,"{",i.representationStart,i.representationEnd,void 0];case J:return i.advanceCodePoint(),[Re.CloseCurly,"}",i.representationStart,i.representationEnd,void 0];case E:case H:return function(e,t){let n="";const s=t.readCodePoint();for(;;){const i=t.readCodePoint();if(!1===i)return e.onParseError(new S("Unexpected EOF while consuming a string token.",t.representationStart,t.representationEnd,["4.3.5. Consume a string token","Unexpected EOF"])),[Re.String,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:n}];if(ye(i))return e.onParseError(new S("Unexpected newline while consuming a string token.",t.representationStart,t.representationEnd,["4.3.5. Consume a string token","Unexpected newline"])),t.unreadCodePoint(),[Re.BadString,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0];if(i===s)return[Re.String,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:n}];if(i!==G)n+=String.fromCodePoint(i);else{if(void 0===t.codePointSource[t.cursor])continue;if(ye(t.codePointSource[t.cursor])){t.advanceCodePoint();continue}n+=String.fromCodePoint(Oe(e,t))}}}(o,i);case X:return function(e,t){if(t.advanceCodePoint(),void 0!==t.codePointSource[t.cursor]&&(Se(t.codePointSource[t.cursor])||we(t))){let n=Ne.Unrestricted;be(0,t)&&(n=Ne.ID);const s=ke(e,t);return[Re.Hash,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:String.fromCodePoint(...s),type:n}]}return[Re.Delim,"#",t.representationStart,t.representationEnd,{value:"#"}]}(o,i);case q:case k:return Ie(i)?xe(o,i):(i.advanceCodePoint(),[Re.Delim,i.source[i.representationStart],i.representationStart,i.representationEnd,{value:i.source[i.representationStart]}]);case F:case I:case O:case P:case ie:return function(e){for(;Ee(e.codePointSource[e.cursor]);)e.advanceCodePoint();return[Re.Whitespace,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,void 0]}(i);case A:return Ie(i)?xe(o,i):Ce(i)?(i.advanceCodePoint(3),[Re.CDC,"--\x3e",i.representationStart,i.representationEnd,void 0]):be(0,i)?Le(o,i):(i.advanceCodePoint(),[Re.Delim,"-",i.representationStart,i.representationEnd,{value:"-"}]);case U:return ve(i)?(i.advanceCodePoint(4),[Re.CDO,"\x3c!--",i.representationStart,i.representationEnd,void 0]):(i.advanceCodePoint(),[Re.Delim,"<",i.representationStart,i.representationEnd,{value:"<"}]);case M:if(i.advanceCodePoint(),be(0,i)){const e=ke(o,i);return[Re.AtKeyword,i.source.slice(i.representationStart,i.representationEnd+1),i.representationStart,i.representationEnd,{value:String.fromCodePoint(...e)}]}return[Re.Delim,"@",i.representationStart,i.representationEnd,{value:"@"}];case G:return we(i)?Le(o,i):(i.advanceCodePoint(),o.onParseError(new S('Invalid escape sequence after "\\"',i.representationStart,i.representationEnd,["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"])),[Re.Delim,"\\",i.representationStart,i.representationEnd,{value:"\\"}])}return i.advanceCodePoint(),[Re.Delim,i.source[i.representationStart],i.representationStart,i.representationEnd,{value:i.source[i.representationStart]}]},endOfFile:function(){return void 0===i.codePointSource[i.cursor]}}}function Be(){}!function(e){e.Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token",e.UnicodeRange="unicode-range-token"}(Re||(Re={})),function(e){e.Integer="integer",e.Number="number"}(Me||(Me={})),function(e){e.Unrestricted="unrestricted",e.ID="id"}(Ne||(Ne={}));Object.values(Re);const je=e=>["chrome-extension://","moz-extension://"].some((t=>e.startsWith(t))),ze=e=>!["data:","ftp://","chrome://","mailto:","#"].some((t=>e.startsWith(t)))&&!je(e),Ue=(e,t)=>{if(e=e.trim(),e.startsWith("blob:"))return e;if(!ze(e)||(e=>["http://","https://"].some((t=>e.startsWith(t))))(e)||je(e))return e;try{return String(new URL(e,t))}catch(n){throw i.R.error("Could not parse an url from parts, path:",e,", owner file url:",t),n}},Fe="url(",Ve=new Set(["hover","focus","focus-within"]),_e=[{from:"max-device-width",to:"max-width"},{from:"min-device-width",to:"min-width"},{from:"max-device-height",to:"max-height"},{from:"min-device-height",to:"min-height"}],Qe=(e,t,n,s)=>{const i=[],o=e[0],r=e[1],a=e[4].value,d=r.indexOf(a);let c,u;if(-1===d?o===Re.URL?(c=Fe,u=")"):c=u=r.slice(0,1):(c=r.slice(0,d),u=r.slice(d+a.length)),a&&ze(a)){i.push(a);let o=a;t&&(s?o=t(((e,t)=>{if(!t.document)return e;try{const n=t.document.createElement("a");return n.href=e,n.href}catch(t){if(t instanceof TypeError&&"can't access dead object"===t.message)return e;throw t}})(a,s)):n&&(o=t(Ue(a,n)))),e[1]=`${c}${o}${u}`,e[4].value=o}return i},$e=({convertUrl:e,cssFileUrl:t,cssText:n,currentWindow:s,handleOnlyUrls:i})=>{const o=function(e,t){const n=De(e,t),s=[];{for(;!n.endOfFile();){const e=n.nextToken();e&&s.push(e)}const e=n.nextToken();e&&s.push(e)}return s}({css:n}),r=[];for(let n=0;n<o.length;n++){const a=o[n],d=a[0],c=o[n+1];switch(d){case Re.Function:a[1]===Fe&&c[0]===Re.String&&r.push(...Qe(c,e,t,s));break;case Re.URL:r.push(...Qe(a,e,t,s));break;case Re.AtKeyword:if("@import"===a[1]){const i=o[n+2];if(c[0]===Re.Whitespace&&i[0]===Re.String&&r.push(...Qe(i,e,t,s)),c[0]===Re.Whitespace&&i[0]===Re.OpenParen){const i=o[n+3];i[0]===Re.String&&r.push(...Qe(i,e,t,s))}}break;case Re.Ident:if(!i){const e=_e.find((e=>a[1]===e.from));e&&(a[1]=e.to,a[4].value=e.to)}break;case Re.Colon:if(!i&&c&&c[0]===Re.Ident&&Ve.has(c[1])){a[1]=".";const e=`__replay-${c[1]}__`;if(c[1]=e,c[4].value=e,o[n-1]&&o[n-2]&&o[n-3]&&o[n-1][0]===Re.Ident&&o[n-2][0]===Re.Colon&&o[n-3][0]===Re.Colon){const e=o[n-3],t=o[n-2],s=o[n-1],i=a,r=c;o[n-3]=i,o[n-2]=r,o[n-1]=e,o[n]=t,o[n+1]=s}}}}return{tokens:o,urls:r}},Xe=({cssFileUrl:e,cssText:t})=>{let n=[];try{n=(e=>{const{urls:t}=$e({cssText:e,handleOnlyUrls:!0});return t})(t)}catch(e){throw i.R.error("Failed to extract urls from css with tokenizer",e),e}return Array.from(new Set(n.map((t=>Ue(t,e)))))},Ye=e=>{try{return(e=>{const{tokens:t}=$e({...e,handleOnlyUrls:!1});return t.map((e=>e[1])).join("")})(e)}catch(e){throw i.R.error("Failed to transform css for player with tokenizer",e),e}};class qe{}qe.encode=e=>ze(e)?`${d.iS}${e}${d.Ru}`:e;class He{static serializeCssText(e){const t=[];void 0===e.convertUrl&&(e.convertUrl=e=>(t.push({url:e}),qe.encode(e)));const n=Ye(e);return{assets:t,value:n}}}He.extractUrlsFromCssText=({cssFileUrl:e,cssText:t})=>Xe({cssFileUrl:e,cssText:t}),He.serializeCssRulesFromSheet=(e,t)=>{let n="";const s=[];try{for(let i=0;i<e.cssRules.length;i++){const o=e.cssRules[i],r=He.serializeCssText({cssText:o.cssText,currentWindow:t});s.push(...r.assets),n+=r.value}}catch(t){i.R.debug(`Cannot access cssRules of ${e.href}`)}return{assets:s,value:n}},He.serializeStyleValue=(e,t)=>{let n="",s=[];if(e.sheet){const i=He.serializeCssRulesFromSheet(e.sheet,t);s=i.assets,n=i.value}if(0===n.length){const i=He.serializeCssText({cssText:e.textContent?e.textContent.trim():"",currentWindow:t});s=i.assets,n=i.value}return{assets:s,value:n}};class Ke{constructor(e,t,n){this.currentWindow=e,this.nodeInfoManager=t,this.listeners=n,this.areCssRuleProxiesAttached=!1,this.idsByAdoptedSheets=new WeakMap,this.isObserving=!1,this.nextSheetId=0,this.observedDocumentsAndShadowRoots=new Set,this.rootsByAdoptedSheets=new WeakMap,this.attachAdoptedStyleSheetProxy=e=>{try{const t=this;m(e.prototype,"adoptedStyleSheets",(function(e){return{set(n){var s;if(null===(s=e.set)||void 0===s||s.apply(this,[n]),t.isObserving)try{t.processAdoptedStyleSheets(this,!0)}catch(e){i.R.error("Error happened in adoptedStylesheet proxy",e)}}}}))}catch(e){i.R.debug("Cannot apply adoptedStylesheet proxy",e)}},this.createAdoptedStyleSheetId=e=>{const t=this.nextSheetId;return this.idsByAdoptedSheets.set(e,t),this.nextSheetId+=1,t},this.getAdoptedSheetId=e=>this.idsByAdoptedSheets.get(e),this.getStyleSheetMetadata=e=>{var t,n,s;const i=e.ownerNode,o=i&&(0,g.Ll)(i)?null===(t=this.nodeInfoManager.getNodeInfo(i))||void 0===t?void 0:t.id:void 0;if(i&&void 0===o)return;const r=[null!==(s=null===(n=e.ownerNode)||void 0===n?void 0:n.ownerDocument)&&void 0!==s?s:this.currentWindow.document,...this.observedDocumentsAndShadowRoots];for(const t of r){const n=t.styleSheets;for(let s=0;s<n.length;s++)if(n[s]===e)return{rootId:this.nodeInfoManager.getIdByNodeOrCreateNewOne(t),styleElementId:o,styleSheetIndex:s}}},this.processAdoptedStyleSheets=(e,t=!1,n)=>{const s=e.adoptedStyleSheets;if(void 0===s)return;if(0===s.length&&!t)return;if(void 0===this.nodeInfoManager.getIdByNode(e))return;const i=this.nodeInfoManager.getIdByNodeOrCreateNewOne(e),o=[];for(let t=0;t<s.length;t++){const r=s[t];let a=this.getAdoptedSheetId(r);const d=this.rootsByAdoptedSheets.get(r);d?d.add(e):this.rootsByAdoptedSheets.set(r,new Set([e])),void 0===a&&(a=this.createAdoptedStyleSheetId(r),this.listeners.onAdoptedStyleSheetDiscovered({rootId:i,rules:Array.from(r.cssRules).map((e=>this.processCssRule(e))),sheetId:a},"number"==typeof n?n+.001:void 0)),o.push(a)}this.listeners.onAdoptedStyleSheetsAssigned({rootId:i,sheetIds:o},"number"==typeof n?n+.002:void 0)}}disconnect(){this.isObserving=!1,this.observedDocumentsAndShadowRoots.clear()}disconnectShadowRoot(e){this.observedDocumentsAndShadowRoots.delete(e);const t=e.adoptedStyleSheets;for(let n=0;n<t.length;n++){const s=t[n],i=this.rootsByAdoptedSheets.get(s);i&&(i.delete(e),0===i.size&&(this.rootsByAdoptedSheets.delete(s),this.idsByAdoptedSheets.delete(s)))}}observe(e,t){this.observedDocumentsAndShadowRoots.add(null!=e?e:this.currentWindow.document),void 0!==this.currentWindow.CSSStyleSheet?(this.isObserving=!0,this.areCssRuleProxiesAttached||(this.attachInsertRuleProxy(),this.attachDeleteRuleProxy(),this.attachReplaceRuleProxy(),this.attachReplaceSyncRuleProxy(),this.attachCSSGroupingRuleInsertRuleProxy(),this.attachCSSGroupingRuleDeleteRuleProxy(),this.attachCSSStyleDeclarationSetPropertyProxy(),this.attachCSSStyleDeclarationRemovePropertyProxy(),this.attachAdoptedStyleSheetProxy(this.currentWindow.Document),this.attachAdoptedStyleSheetProxy(this.currentWindow.ShadowRoot),this.areCssRuleProxiesAttached=!0),e&&this.processAdoptedStyleSheets(e,!1,t)):i.R.debug("Window object is cleared and does not contain CSSStyleSheet prototype.")}attachCSSGroupingRuleDeleteRuleProxy(){const e=this;try{f(this.currentWindow.CSSGroupingRule.prototype,"deleteRule",(t=>function(n){const s=t(n);if(e.isObserving&&this.parentStyleSheet)try{const t=Array.from(this.parentStyleSheet.cssRules).indexOf(this);-1!==t&&this.parentStyleSheet&&(e.handleCssRule(this.parentStyleSheet,t),e.handleCssRule(this.parentStyleSheet,t,this))}catch(e){i.R.error("Error happened in `CSSGroupingRule.deleteRule` proxy.",e,n)}return s}))}catch(e){i.R.debug("Cannot apply `deleteRule` proxy to CSSGroupingRule.",e)}}attachCSSGroupingRuleInsertRuleProxy(){const e=this;try{f(this.currentWindow.CSSGroupingRule.prototype,"insertRule",(t=>function(n,s){const o=t(n,s);if(e.isObserving&&this.parentStyleSheet)try{const t=Array.from(this.parentStyleSheet.cssRules).indexOf(this);-1!==t&&this.parentStyleSheet&&(e.handleCssRule(this.parentStyleSheet,t),e.handleCssRule(this.parentStyleSheet,t,this))}catch(e){i.R.error("Error happened in `CSSGroupingRule.insertRule` proxy.",e,s)}return o}))}catch(e){i.R.debug("Cannot apply `insertRule` proxy to CSSGroupingRule.",e)}}attachCSSStyleDeclarationRemovePropertyProxy(){const e=this;try{f(this.currentWindow.CSSStyleDeclaration.prototype,"removeProperty",(t=>function(...n){const s=t(...n);if(e.isObserving&&this.parentRule&&this.parentRule.parentStyleSheet)try{const t=Array.from(this.parentRule.parentStyleSheet.cssRules).indexOf(this.parentRule);-1!==t&&(e.handleCssRule(this.parentRule.parentStyleSheet,t),e.handleCssRule(this.parentRule.parentStyleSheet,t,this.parentRule))}catch(e){i.R.error("Error happened in `CSSStyleDeclaration.removeProperty` proxy.",e,n)}return s}))}catch(e){i.R.debug("Cannot apply `removeProperty` proxy to CSSStyleDeclaration.",e)}}attachCSSStyleDeclarationSetPropertyProxy(){const e=this;try{f(this.currentWindow.CSSStyleDeclaration.prototype,"setProperty",(t=>function(...n){const s=t(...n);if(e.isObserving&&this.parentRule&&this.parentRule.parentStyleSheet)try{const t=Array.from(this.parentRule.parentStyleSheet.cssRules).indexOf(this.parentRule);-1!==t&&(e.handleCssRule(this.parentRule.parentStyleSheet,t),e.handleCssRule(this.parentRule.parentStyleSheet,t,this.parentRule))}catch(e){i.R.error("Error happened in `CSSStyleDeclaration.setProperty` proxy.",e,n)}return s}))}catch(e){i.R.debug("Cannot apply `setProperty` proxy to CSSStyleDeclaration.",e)}}attachDeleteRuleProxy(){const e=this;try{f(this.currentWindow.CSSStyleSheet.prototype,"deleteRule",(t=>function(n){if(t(n),e.isObserving)try{e.handleCssRule(this,n)}catch(e){i.R.error("Error happened in `deleteRule` proxy.",e,n)}}))}catch(e){i.R.debug("Cannot apply `deleteRule` proxy to CSSStyleSheet.",e)}}attachInsertRuleProxy(){const e=this;try{f(this.currentWindow.CSSStyleSheet.prototype,"insertRule",(t=>function(n,s){const o=t(n,s),r=this.cssRules[o];if(e.isObserving)try{e.handleCssRule(this,s,r)}catch(e){i.R.error("Error happened in `insertRule` proxy.",e,n,s,r,o)}return o}))}catch(e){i.R.debug("Cannot apply `insertRule` proxy to CSSStyleSheet.",e)}}attachReplaceRuleProxy(){const e=this;try{f(this.currentWindow.CSSStyleSheet.prototype,"replace",(t=>function(n){const s=t(n);return s.then((t=>{if(e.isObserving)try{e.handleStylesheetReplace(t)}catch(e){i.R.error("Error happened in `replace` proxy.",e,s,n)}})),s}))}catch(e){i.R.debug("Cannot apply `replace` proxy to CSSStyleSheet.",e)}}attachReplaceSyncRuleProxy(){const e=this;try{f(this.currentWindow.CSSStyleSheet.prototype,"replaceSync",(t=>function(n){const s=t(n);if(e.isObserving)try{e.handleStylesheetReplace(this)}catch(e){i.R.error("Error happened in `replace` proxy.",e,s,n)}return s}))}catch(e){i.R.debug("Cannot apply `replace` proxy to CSSStyleSheet.",e)}}handleCssRule(e,t,n){const s=[{rule:n&&this.processCssRule(n),ruleIndex:t}],i=this.getAdoptedSheetId(e);if(void 0===i){const t=this.getStyleSheetMetadata(e);if(void 0===t)return;this.listeners.onStyleSheetMutationProcessed(Object.assign(Object.assign({},t),{rules:s}))}else this.listeners.onAdoptedStyleSheetMutationProcessed({rules:s,sheetId:i})}handleStylesheetReplace(e){const t=this.getAdoptedSheetId(e);void 0!==t&&this.listeners.onAdoptedStyleSheetMutationProcessed({replace:Array.from(e.cssRules).map((e=>this.processCssRule(e))).join("\n"),sheetId:t})}processCssRule(e){const{assets:t,value:n}=He.serializeCssText({cssText:e.cssText,currentWindow:this.currentWindow});return t.forEach((e=>this.listeners.onAssetDiscovered(e))),n}}var Ge=n(191),Je=n(3906),Ze=n(5474),et=n(4693),tt=n(403);const nt=()=>(0,tt.JU)((0,tt._5)());var st=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};const it={capture:!0,passive:!0};class ot{get currentWindow(){if((0,o.VP)(this._currentWindow))return this._currentWindow;throw new TypeError("Window origin changed")}get nodeInfoManager(){return this.taskConfig.windowScopedManagers.nodeInfo}get privacyManager(){return this.taskConfig.windowScopedManagers.privacy}get taskEmitter(){return this.taskConfig.taskEmitter}get scrollManager(){return this.taskConfig.moduleScopedManagers.scroll}get uploadEvent(){return this.taskConfig.uploadEvent}get windowIdManager(){return this.taskConfig.instrumentationScopedManagers.windowIdManager}constructor(e,t){this._currentWindow=e,this.taskConfig=t,this.documentEventListenersMap=new Map,this.windowEventListenersMap=new Map,this.createEventEnvelope=e=>({id:Ze.$(),timestamp:null!=e?e:nt(),windowId:this.windowIdManager.getWindowId(this.currentWindow)}),this.shouldProcessEvent=e=>{if("unhandledrejection"===e.type&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return!0;if(!((0,et.Q)(e)||["input","change"].includes(e.type)&&this.taskConfig.exportForTests))return!1;const t=e.composedPath()[0];return void 0===t||!(0,g.vq)(t)||!this.privacyManager.isNodeExcluded(t)}}addDocumentEventListener(e,t,n=it){let s=this.documentEventListenersMap.get(e);void 0===s&&(s=new Map,this.documentEventListenersMap.set(e,s));const{shouldProcessEvent:o}=this,r=function(n){return st(this,void 0,void 0,(function*(){if(o(n))try{yield t.call(this,n)}catch(t){i.R.error(`Error happened in '${e}' document event listener`,t)}}))};this.currentWindow.document.addEventListener(e,r,n),s.set(t,r)}addEventListener(e,t,n=it){let s=this.windowEventListenersMap.get(e);void 0===s&&(s=new Map,this.windowEventListenersMap.set(e,s));const{shouldProcessEvent:o}=this,r=function(n){return st(this,void 0,void 0,(function*(){if(o(n))try{yield t.call(this,n)}catch(t){i.R.error(`Error happened in '${e}' window event listener`,t)}}))};this.currentWindow.addEventListener(e,r,n),s.set(t,r)}isTaskRunWithinMainWindow(){return 1===this.windowIdManager.getWindowId(this.currentWindow)}removeDocumentEventListener(e,t,n=it){var s;const r=this.documentEventListenersMap.get(e);if(r){const a=r.get(t);a&&(r.delete(t),(0,o.VP)(this.currentWindow)&&((null===(s=this.currentWindow.document)||void 0===s?void 0:s.removeEventListener)?this.currentWindow.document.removeEventListener(e,a,n):i.R.debug("window.document.removeEventListener is undefined")))}}removeEventListener(e,t,n=it){const s=this.windowEventListenersMap.get(e);if(s){const r=s.get(t);r&&(s.delete(t),(0,o.VP)(this.currentWindow)&&(this.currentWindow.removeEventListener?this.currentWindow.removeEventListener(e,r,n):i.R.debug("window.removeEventListener is undefined")))}}}const rt=/cdnjs\.|gstatic\.com|jsdelivr\.|fonts\.googleapis\.com|fastcdn\.|kxcdn\.|bootstrapcdn\.com/iu;var at=n(5190),dt=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};class ct{constructor(e={maxParallelPromises:10}){this.config=e,this.pendingTasksQueue=[],this.currentParallelPromises=0}processPromiseTask(e){this.pendingTasksQueue.push(e),this.spawnTaskProcessorIfNeeded()}processPendingTask(){return dt(this,void 0,void 0,(function*(){const e=this.pendingTasksQueue.shift();e&&(yield e())}))}spawnTaskProcessorIfNeeded(){return dt(this,void 0,void 0,(function*(){if(0!==this.pendingTasksQueue.length&&!(this.currentParallelPromises>=this.config.maxParallelPromises)){this.currentParallelPromises+=1;try{yield this.processPendingTask()}finally{this.currentParallelPromises-=1,this.spawnTaskProcessorIfNeeded()}}}))}}var ut=n(6200);class lt extends Error{constructor(e){super(e),this.name="AssetError"}}var ht,pt=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};class vt{}ht=vt,vt.serialize=(e,t,...n)=>pt(void 0,[e,t,...n],void 0,(function*(e,t,n=0){try{const s=yield t(e,{priority:"low"});if(!s.ok)throw new lt(`Failed to fetch asset on url: '${e}'`);const i=s.headers.get("content-type");return(null==i?void 0:i.trim().startsWith("text/css"))?ht.serializeCssFile(s,t,e,n):ht.serializeArbitraryFile(s)}catch(t){throw new lt(`Error while fetching asset on url: '${e}'\n${t}`)}})),vt.convertBlobToBase64=e=>new Promise(((t,n)=>{const s=new FileReader;s.addEventListener("error",(e=>n([e,"error"]))),s.addEventListener("abort",(e=>n([e,"abort"]))),s.addEventListener("loadend",(()=>{"string"==typeof s.result?t(s.result):n("typeof reader.result is "+typeof s.result)})),s.readAsDataURL(e)})),vt.serializeArbitraryFile=e=>pt(void 0,void 0,void 0,(function*(){const t=yield e.blob();return yield ht.convertBlobToBase64(t)})),vt.serializeCssFile=(e,t,n,s)=>pt(void 0,void 0,void 0,(function*(){if(s>3)return n;const o=yield e.text(),r=He.extractUrlsFromCssText({cssFileUrl:n,cssText:o}),a={};yield Promise.allSettled(r.map((e=>pt(void 0,void 0,void 0,(function*(){try{a[e]=yield ht.serialize(e,t,s+1)}catch(t){i.R.error("Error while processing asset",{error:t,url:e})}})))));const{value:d}=He.serializeCssText({convertUrl:e=>{var t;return null!==(t=a[e])&&void 0!==t?t:e},cssFileUrl:n,cssText:o});return yield ht.convertBlobToBase64(new Blob([d],{type:"text/css"}))}));var gt=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};class ft{constructor(e){this.config=e,this.parallelTaskProcessor=new ct,this.processDiscoveredNetworkAsset=e=>gt(this,void 0,void 0,(function*(){const{url:t}=e;if(!ze(t)||ut.w.isCached(t))return;this.config.isDebug||ut.w.addToCache(t);const n=ft.isAssetProxiable(e);if(this.config.packAssets||!n)try{yield new Promise(((t,n)=>{this.parallelTaskProcessor.processPromiseTask((()=>this.downloadAsset(e).then(t).catch(n)))}))}catch(s){i.R.error("Error while processing asset",{error:s,url:t}),n?(i.R.debug("Asset is proxied instead",e),this.proxyAsset(e)):i.R.debug("Asset is not proxiable",e)}else this.proxyAsset(e)})),this.downloadAsset=e=>gt(this,void 0,void 0,(function*(){const t=yield vt.serialize(e.url,this.config.originalFetch);if(t.length>10485760)throw new lt("Asset size exceeded.");const n=Object.assign(Object.assign({},e),{content:t});this.config.uploadProcessedAsset(n)}))}static isAssetProxiable(e){return!rt.test(e.url)&&(!(0,at.nA)(e.url)&&!(0,at.TI)(e.url))}proxyAsset(e){this.config.cacheAsset(Object.assign(Object.assign({},e),{timestamp:this.config.timeService.getServerTimestamp()}))}}class mt{get size(){return this.countByElement.size}constructor(e){this.countByElement=new Map,this.initialize(e)}add(e){this.incrementElementCount(e)}delete(e){this.decrementElementCount(e)}has(e){return Boolean(this.countByElement.get(e))}some(e){for(const t of this.countByElement.keys())if(e(t))return!0;return!1}decrementElementCount(e){const t=this.countByElement.get(e);1===t?this.countByElement.delete(e):t&&this.countByElement.set(e,t-1)}incrementElementCount(e){const t=this.countByElement.get(e)||0;this.countByElement.set(e,t+1)}initialize(e){if(e)for(const t of e)this.incrementElementCount(t)}}const St={attributeOldValue:!0,attributes:!0,characterData:!0,childList:!0,subtree:!0};class yt{constructor(e,t,n,s){let i;this.currentWindow=e,this.nodeProcessor=t,this.privacyManager=n,this.listeners=s,this.futureAttributesTargets=new WeakMap,this.futureTargets=new mt,this.pendingMutations=[],this.isNodeInMutationQueue=e=>this.futureTargets.some((t=>t.contains(e))),this.findNodeInSerializedNodes=(e,t)=>{for(const n of t){if(n.id===e)return n;if(n.children&&n.children.length>0){const t=this.findNodeInSerializedNodes(e,n.children);if(t)return t}}},this.getTargetsFromChildListMutation=e=>"childList"===e.type&&(0,g.ST)(e.target)?[e.target]:[...Array.from(e.addedNodes),...Array.from(e.removedNodes)],this.isAttributeInMutationQueue=e=>{var t;return null!==e.attributeName&&(null===(t=this.futureAttributesTargets.get(e.target))||void 0===t?void 0:t.has(e.attributeName))},this.removeMutationFutureTargets=e=>{if("childList"===e.type)this.getTargetsFromChildListMutation(e).forEach((e=>{this.futureTargets.delete(e)}));else if("attributes"===e.type){const t=this.futureAttributesTargets.get(e.target);t&&null!==e.attributeName&&(t.delete(e.attributeName),0===t.size&&this.futureAttributesTargets.delete(e.target))}else"characterData"===e.type&&(0,g.ST)(e.target.parentNode)&&this.futureTargets.delete(e.target.parentNode)},this.mutationObserver=new MutationObserver((e=>{const t=nt();e.forEach((e=>{if("attributes"===e.type&&null!==e.attributeName){const t=this.futureAttributesTargets.get(e.target);t?t.add(e.attributeName):this.futureAttributesTargets.set(e.target,new mt([e.attributeName])),(0,g.B6)(e.target)&&"type"===e.attributeName&&("password"!==e.oldValue&&"password"!==e.target.type||this.privacyManager.setIsPasswordInput(e.target))}else"childList"===e.type?this.getTargetsFromChildListMutation(e).forEach((e=>{this.futureTargets.add(e)})):"characterData"===e.type&&(0,g.ST)(e.target.parentNode)&&this.futureTargets.add(e.target.parentNode)})),this.pendingMutations.push({mutationRecords:e,time:t})})),this.mutationProcessIntervalId=setInterval((()=>{if(this.pendingMutations.length>0){const e=this.pendingMutations[this.pendingMutations.length-1];if(i===e)return;i=e,v.postTask("handlePendingMutations",(()=>this.handlePendingMutations(e)))}}),50)}disconnect(){this.mutationObserver.disconnect(),void 0!==this.mutationProcessIntervalId&&(clearInterval(this.mutationProcessIntervalId),this.mutationProcessIntervalId=void 0)}observe(e){this.mutationObserver.observe(e,St)}*handlePendingMutations(e){const t=this.pendingMutations.indexOf(e);if(-1!==t)try{const t=new Set;let n=null;for(const s of this.pendingMutations){if(n===e)break;n=s;const i=[];for(;s.mutationRecords.length>0;){yield;const e=s.mutationRecords.shift();switch(this.removeMutationFutureTargets(e),e.type){case"childList":{const n=yield*this.processChildListMutationRecord(e,t,s.time);i.push(...n);break}case"attributes":{const n=this.processAttributesMutationRecord(e,t);if(n){const e=this.findNodeInSerializedNodes(n.id,i);e?e.attributes=Object.assign(Object.assign({},e.attributes),n.attributes):i.push(n)}break}case"characterData":if((0,g.ST)(e.target.parentNode)){const t=yield*this.processStyleSheetMutation(e.target.parentNode,s.time);t&&i.push(t)}else{const t=this.processCharacterDataMutationRecord(e);if(t){const e=this.findNodeInSerializedNodes(t.id,i);e?e.value=t.value:i.push(t)}}}}i.length>0&&this.listeners.onMutationsProcessed(i,s.time)}}catch(e){throw this.pendingMutations.slice(0,t).forEach((e=>{e.mutationRecords.forEach((e=>this.removeMutationFutureTargets(e)))})),e}finally{this.pendingMutations=this.pendingMutations.slice(t+1)}else i.R.error("No end mutation was found in pending mutations. MutationProcessor.handlePendingMutations exited early.")}processAttributesMutationRecord(e,t){var n,s;if(null===e.attributeName)return;if(this.isAttributeInMutationQueue(e))return;if(this.isNodeInMutationQueue(e.target))return void t.add(e.target);if(!this.nodeProcessor.shouldProcessUpdatedNode(e.target))return;if(this.privacyManager.recomputeNodePrivacyInfoForNodeAndItsSubtree(e.target),this.privacyManager.isNodeExcluded(e.target))return;const i=this.nodeProcessor.processUpdatedNode(e.target);if(i){let t=e.attributeName;(0,g.bK)(e.target)&&["src","srcdoc"].includes(e.attributeName)&&(t=`data-appd-${e.attributeName}`);const o={[t]:null!==(s=null===(n=i.attributes)||void 0===n?void 0:n[t])&&void 0!==s?s:null};return{id:i.id,action:"updated",attributes:o}}}processCharacterDataMutationRecord(e){if(!this.isNodeInMutationQueue(e.target)&&this.nodeProcessor.shouldProcessUpdatedNode(e.target)&&(!e.target.parentNode||!this.privacyManager.isNodeExcluded(e.target.parentNode)))return this.nodeProcessor.processUpdatedNode(e.target)}*processChildListMutationRecord(e,t,n){const s=[];if((0,g.ST)(e.target)){const t=yield*this.processStyleSheetMutation(e.target,n);return t&&s.push(t),s}const i=new Set(Array.from(e.addedNodes));for(const t of Array.from(e.removedNodes)){if(!this.nodeProcessor.shouldProcessRemovedNode(t))continue;if(this.isNodeInMutationQueue(t))continue;if(i.has(t))continue;const n=this.nodeProcessor.processRemovedNode(t,e.target);n&&s.push(n)}const o=e.target;if(this.privacyManager.retrieveAndStoreNodePrivacyInfo(o),this.nodeProcessor.shouldProcessAddedNode(o)){if(!this.isNodeInMutationQueue(o)){const e=yield*this.nodeProcessor.processAddedNodeAndItsSubtree(o,n);e&&s.push(e)}}else for(const i of Array.from(e.addedNodes)){if(!this.nodeProcessor.shouldProcessAddedNode(i)&&!t.has(i))continue;if(this.isNodeInMutationQueue(i))continue;const e=yield*this.nodeProcessor.processAddedNodeAndItsSubtree(i,n);e&&s.push(e)}return s}*processStyleSheetMutation(e,t){if(e.isConnected&&!this.isNodeInMutationQueue(e))return yield*this.nodeProcessor.processAddedNodeAndItsSubtree(e,t)}}var Et=n(485),wt=n(607);class bt{constructor(e){this.listeners=e,this.dimensionsByElement=new WeakMap,this.pendingResizeEntries=[],this.resizeObserver=new ResizeObserver((e=>{this.pendingResizeEntries.push(...e),void 0===this.resizeProcessTimeoutId&&(this.resizeProcessTimeoutId=setTimeout((()=>{const e=this.pendingResizeEntries;this.pendingResizeEntries=[],this.resizeProcessTimeoutId=void 0;const t=e.map((e=>e.target)).filter(((e,t,n)=>n.indexOf(e)===t));v.postTask("handleResizedExcludedNodes",(()=>this.processResizedExcludedElements(t)))}),100))}))}deleteExcludedElementDimensions(e){this.dimensionsByElement.delete(e)}disconnect(){this.resizeObserver.disconnect(),void 0!==this.resizeProcessTimeoutId&&(clearInterval(this.resizeProcessTimeoutId),this.resizeProcessTimeoutId=void 0)}observeExcludedElement(e){this.resizeObserver.observe(e)}processExcludedElement(e){const t=e.getBoundingClientRect();return this.dimensionsByElement.set(e,{height:t.height,width:t.width}),{height:t.height,isExcluded:!0,width:t.width}}shouldProcessExcludedElement(e){if(!e.isConnected)return this.resizeObserver.unobserve(e),!1;const t=this.dimensionsByElement.get(e),n=e.getBoundingClientRect();return!t||t.height!==n.height||t.width!==n.width}*processResizedExcludedElements(e){this.listeners.onExcludedNodesResized(e)}}const It=new Set(["title","alt","onabort","onauxclick","onblur","oncanplay","oncancel","oncanplaythrough","onchange","onclick","onclose","oncontextmenu","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformchange","onformdata","onforminput","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onwheel","onpaste","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onscroll","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting"]),Pt=/\s*([^,]\S*[^,](?:\s+[^,]+)?)\s*(?:,|$)/;class Ct{static processSrcSetAttribute(e,t){const n=[],s=e.split(Pt).filter(((e,t)=>t%2==1)).map((e=>e.trim().split(/\s+/))).filter((([e])=>!(0,at.Jb)(e))).map((([e,...s])=>{let i=e;return e.startsWith("data:")||e.startsWith("blob:")||(i=(0,at.zf)(e,t)),n.push({url:i}),[qe.encode(i),...s].join(" ")})).join(", ");return{assets:n,srcset:s}}}var Rt=n(1802),Mt=n(718);class Nt{constructor(e){this.privacyManager=e}static isSerializableInput(e){return(0,g.oq)(e)}serializeInputValue(e){let t=e.getAttribute("value"),n=e.getAttribute("placeholder");if(this.privacyManager.shouldMaskTextNode(e)&&(0,Rt.Kg)(n)&&(n=(0,Mt.gC)(n)),this.privacyManager.isSensitiveInput(e))return{attributes:{placeholder:n,value:null},value:null};let s=(0,g.B6)(e)&&["checkbox","radio"].includes(e.type)?this.getCheckedValue(e):e.value;return["submit","button"].includes(e.type)&&(t=e.value),this.privacyManager.shouldMaskInputNode(e)&&(s=(0,Mt.gC)(s),(0,Rt.Kg)(t)&&(t=(0,Mt.gC)(t))),{attributes:{placeholder:n,value:t},value:s}}getCheckedValue(e){return this.privacyManager.shouldMaskInputNode(e)?"":String(e.checked)}}class Tt{constructor(e){this.privacyManager=e}serializeMaskedNode(e){return Object.assign(Object.assign({},e),{isMasked:!0})}shouldSerializeMaskedNode(e){const t=(0,g.B6)(e)&&this.privacyManager.shouldMaskInputNode(e),n=!(0,g.B6)(e)&&this.privacyManager.shouldMaskTextNode(e);return t||n}}class Ot{constructor(e){this.privacyManager=e}serializeTextNode(e){const t=e.nodeValue;return null===t?"":this.privacyManager.shouldMaskTextNode(e)?(0,Mt.gC)(t):t}}class kt{constructor(e){this.privacyManager=e,this.inputSerializer=new Nt(this.privacyManager),this.maskedNodeSerializer=new Tt(this.privacyManager),this.textSerializer=new Ot(this.privacyManager)}serializeNode(e,t){const n={nodeName:e.nodeName},s=[];if((0,g.a8)(e))n.attributes={name:e.name,publicId:e.publicId,systemId:e.systemId};else if((0,g.ir)(e))null!==e.nodeValue&&(n.value=this.textSerializer.serializeTextNode(e));else if((0,g.vq)(e)){if(n.attributes=((e,t)=>{const n={},s=e.attributes;if(s&&s.length>0)for(let e=0;e<s.length;e++){const i=s[e];if(!It.has(i.name))if(["src","href"].includes(i.name)){if((0,at.Jb)(i.value)||i.value.startsWith("blob:")||i.value.startsWith("chrome:"))continue;if(i.value.startsWith("#")){n[i.name]=i.value;continue}n[i.name]=(0,at.zf)(i.value,t)}else n[i.name]=i.value}else if(void 0===(null==s?void 0:s.length)&&"function"==typeof e.getAttribute){const t=e.getAttribute("id");"string"==typeof t&&(n.id=t);const s=e.getAttribute("class");"string"==typeof s&&(n.class=s)}return n})(e,t),(0,g.lg)(e)&&(n.origin=t.origin),(0,g.Wj)(e)&&(!n.attributes.data||n.attributes.data.startsWith("blob:")||n.attributes.data.startsWith("data:")||(n.attributes.data=(0,at.zf)(n.attributes.data,t))),e.namespaceURI&&e.namespaceURI!==g.tm.XHTML&&(n.namespaceURI=e.namespaceURI),n.attributes.style){const{assets:e,value:i}=He.serializeCssText({cssText:n.attributes.style,currentWindow:t});n.attributes.style=i,s.push(...e)}if((0,g.ST)(e)){const{assets:i,value:o}=He.serializeStyleValue(e,t);n.value=o,s.push(...i)}if((0,g.Gr)(e)){const t=e.href;n.attributes.href=qe.encode(t),s.push({url:t})}if((0,g.A6)(e)){const i=e.src;i&&(s.push({url:i}),n.attributes.src=qe.encode(i));const o=e.srcset;if(o){const e=Ct.processSrcSetAttribute(o,t);n.attributes.srcset=e.srcset,s.push(...e.assets)}}if((0,g.c8)(e)){const i=e.getAttribute("href");if(i){const e=(0,at.zf)(i,t);s.push({url:e}),n.attributes.href=qe.encode(e)}}if((0,g.im)(e)){const i=e.getAttribute("href");if(i&&!i.startsWith("#")){const e=(0,at.zf)(i,t);s.push({url:e}),n.attributes.href=qe.encode(e)}}if((0,g.PV)(e)&&e.parentElement&&(0,g.LY)(e.parentElement)){const i=e.srcset;if(i){const e=Ct.processSrcSetAttribute(i,t);n.attributes.srcset=e.srcset,s.push(...e.assets)}}if(this.maskedNodeSerializer.shouldSerializeMaskedNode(e)){const e=this.maskedNodeSerializer.serializeMaskedNode(n);Object.assign(n,e)}if(Nt.isSerializableInput(e)){const{attributes:t,value:s}=this.inputSerializer.serializeInputValue(e);null===s?delete n.value:n.value=s,n.attributes.value&&(null===t.value?delete n.attributes.value:n.attributes.value=t.value),n.attributes.placeholder&&t.placeholder&&(n.attributes.placeholder=t.placeholder)}(0,g.bK)(e)&&(n.attributes["data-appd-src"]=n.attributes.src,n.attributes["data-appd-srcdoc"]=n.attributes.srcdoc,delete n.attributes.src,delete n.attributes.srcdoc)}return(0,g.iX)(e)&&(n.isAuraShadowRoot=!0),{assets:s,serializedNode:n}}}class xt{constructor(e,t,n,s,o){this.currentWindow=e,this.nodeInfoManager=t,this.privacyManager=n,this.listeners=s,this.config=o,this.processAddedNode=(e,t)=>{const n=this.nodeInfoManager.getIdByNodeOrCreateNewOne(e),s=this.privacyManager.isNodeExcluded(e);this.nodeInfoManager.setNodeInfo(e,{id:n,isMasked:this.privacyManager.isNodeMasked(e),isRecorded:!s,parent:e.parentNode,previousSibling:e.previousSibling}),s||this.listeners.onNodeAdded(e,t),s&&(0,g.vq)(e)&&this.excludedElementProcessor.observeExcludedElement(e);const i=this.serializeNode(e);if(i)return Object.assign({id:n},i)},this.processUpdatedNode=e=>{const t=this.nodeInfoManager.getIdByNode(e);if(void 0===t)return void i.R.warn("Cannot process updated node. Node not found in map.",e);const n=this.serializeNode(e);return n?Object.assign({id:t,action:"updated"},n):void 0},this.shouldProcessAddedNode=e=>{if(!e.isConnected)return!1;const t=this.nodeInfoManager.getNodeInfo(e);return void 0===t||(t.parent!==e.parentNode||t.previousSibling!==e.previousSibling)&&(!t.isRecorded!==this.privacyManager.isNodeExcluded(e)||(t.isMasked!==this.privacyManager.isNodeMasked(e)||!Et.O$(e)))},this.shouldProcessRemovedNode=e=>void 0!==this.nodeInfoManager.getNodeInfo(e),this.shouldProcessUpdatedNode=e=>{if(!e.isConnected)return!1;return void 0!==this.nodeInfoManager.getNodeInfo(e)},this.findPreviousIndexedSiblingId=e=>{let t,n=e.previousSibling;for(;n;){if(t=this.nodeInfoManager.getIdByNode(n),void 0!==t)return t;n=n.previousSibling}},this.onExcludedNodeResized=e=>{const t=nt(),n=[];for(const t of e){const e=this.processUpdatedNode(t);e&&n.push(e)}n.length>0&&this.listeners.onMutationsProcessed(n,t)},this.serializeNode=e=>{if(this.privacyManager.isNodeExcluded(e))return(0,g.vq)(e)&&this.excludedElementProcessor.shouldProcessExcludedElement(e)?this.excludedElementProcessor.processExcludedElement(e):void 0;const{assets:t,serializedNode:n}=this.nodeSerializer.serializeNode(e,this.currentWindow);return t&&t.forEach((e=>this.listeners.onAssetDiscovered(e))),n},this.nodeSerializer=new kt(this.privacyManager),this.excludedElementProcessor=new bt({onExcludedNodesResized:this.onExcludedNodeResized})}disconnect(){this.excludedElementProcessor.disconnect()}*processAddedNodeAndItsSubtree(e,t){var n,s,i;const o=new WeakMap;let r=!1;for(const s of wt.kK(e,{recoverOnNotConnectedNodes:!0,shouldProcessNode:e=>!e.parentNode||!this.privacyManager.isNodeExcluded(e.parentNode),useNativeTreeWalker:this.config.useNativeTreeWalker})){r=!0,this.privacyManager.retrieveAndStoreNodePrivacyInfo(s);const e=this.processAddedNode(s,t),i=(0,g.Ng)(s)||(0,g.iX)(s)?s.host:s.parentNode,a=i&&o.get(i);a&&(a.children=null!==(n=a.children)&&void 0!==n?n:[],e&&a.children.push(e)),e&&o.set(s,e),yield}if(!r)return;const a=o.get(e);if(void 0===a)throw new TypeError("DomTreeSerialized lost root");const d=null!==(s=e.parentNode&&this.nodeInfoManager.getIdByNode(e.parentNode))&&void 0!==s?s:null,c=null!==(i=this.findPreviousIndexedSiblingId(e))&&void 0!==i?i:null;return Object.assign(Object.assign({},a),{action:"added",parentId:d,previousId:c})}processRemovedNode(e,t){const n=this.nodeInfoManager.getNodeInfo(e);for(const t of wt.kK(e,{useNativeTreeWalker:this.config.useNativeTreeWalker}))this.nodeInfoManager.deleteNodeInfo(t),this.privacyManager.deleteNodePrivacyInfo(t),(0,g.vq)(t)&&this.excludedElementProcessor.deleteExcludedElementDimensions(t),this.listeners.onNodeRemoved(t);if(void 0!==n){if(null!==t){if(!t.isConnected)return;const e=this.nodeInfoManager.getNodeInfo(t);if((null==e?void 0:e.parent)!==t.parentNode)return}return{id:n.id,action:"removed"}}}}var At=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))},Wt=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n};class Lt extends ot{constructor(e,t,n){super(e,t),this.startRecordingWindow=n,this.isEnabled=!1,this.onAssetDiscovered=e=>this.assetProcessor.processDiscoveredNetworkAsset(e),this.handleNodeAdded=(e,t)=>{this.isEnabled&&this.onNodeAdded(e,t)},this.handleNodeRemoved=e=>{this.isEnabled&&this.onNodeRemoved(e)},this.onIframeDiscovered=(e,t)=>{const n=t=>{if(this.mutationProcessor.isNodeInMutationQueue(e))return this.nodeInfoManager.deleteLoadListenerForIframe(e),void i.R.warn("Iframe is being processed in pending mutations, skipping this load event.");e.contentWindow?(0,o.VP)(e.contentWindow)?(this.startRecordingWindow(e.contentWindow,{iframeElementId:this.nodeInfoManager.getIdByNodeOrCreateNewOne(e),windowId:this.windowIdManager.getWindowId(this.currentWindow)},t),this.taskConfig.postMessageService.tryToStartSessionInChild(e,{iframeElementId:this.nodeInfoManager.getIdByNodeOrCreateNewOne(e),windowId:this.windowIdManager.getWindowId(this.currentWindow)})):this.taskConfig.postMessageService.tryToStartSessionInChild(e,{iframeElementId:this.nodeInfoManager.getIdByNodeOrCreateNewOne(e),windowId:this.windowIdManager.getWindowId(this.currentWindow)}):i.R.warn("Iframe contentWindow is not available")};Ge.SW(e)?n(t):e.contentWindow&&!(0,o.VP)(e.contentWindow)&&n(),this.nodeInfoManager.getLoadListenerForIframe(e)?i.R.warn("Iframe load listener already exists"):this.nodeInfoManager.setLoadListenerForIframe(e,(()=>n()))},this.onMutationsProcessed=(e,t)=>{this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope(t)),{name:p.NODE_MUTATION,data:{nodes:e},parentMetadata:null}))},this.stopRecordingIframes=()=>{this.isTaskRunWithinMainWindow()&&(this.taskConfig.postMessageService.broadcastEventToAllDiscoveredIframes(Object.assign(Object.assign({},this.taskConfig.postMessageService.createPostMessageEvent()),{name:Je.g4.STOP_SESSION})),this.taskConfig.postMessageService.clearDiscoveredIframeWindows())},this.assetProcessor=new ft(this.taskConfig),this.nodeProcessor=new xt(this.currentWindow,this.nodeInfoManager,this.privacyManager,{onAssetDiscovered:this.onAssetDiscovered,onMutationsProcessed:this.onMutationsProcessed,onNodeAdded:this.handleNodeAdded,onNodeRemoved:this.handleNodeRemoved},{useNativeTreeWalker:t.useNativeTreeWalker}),this.mutationProcessor=new yt(this.currentWindow,this.nodeProcessor,this.privacyManager,{onMutationsProcessed:this.onMutationsProcessed})}disable(){this.isEnabled=!1,this.mutationProcessor.disconnect(),this.nodeProcessor.disconnect(),this.stopRecordingIframes()}enable(){this.isEnabled=!0,this.createDOMSnapshot(),this.mutationProcessor.observe(this.currentWindow.document)}createDOMSnapshot(){return At(this,void 0,void 0,(function*(){const e=this.createSnapshotEvent(),t=yield v.postTask("createDOMSnapshot",(()=>this.nodeProcessor.processAddedNodeAndItsSubtree(this.currentWindow.document,e.timestamp)));if(!t)throw new Error("Serialized document is undefined");const{action:n}=t,s=Wt(t,["action"]);return this.uploadEvent(Object.assign(Object.assign({},e),{data:{rootNode:s}})),e.timestamp}))}onNodeAdded(e,t){(0,g.gh)(e)&&this.mutationProcessor.observe(e),(0,g.bK)(e)&&this.onIframeDiscovered(e,t),this.taskEmitter.emit("nodeAdded",{node:e,rootWindow:this.currentWindow})}onNodeRemoved(e){this.taskEmitter.emit("nodeRemoved",{node:e,rootWindow:this.currentWindow})}}var Dt=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};class Bt extends Lt{constructor(...e){super(...e),this.onAdoptedStyleSheetDiscovered=(e,t)=>{this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope(t)),{name:p.ADOPTED_STYLESHEET,data:e}))},this.onAdoptedStyleSheetMutationProcessed=e=>{this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.ADOPTED_STYLESHEET,data:e}))},this.onAdoptedStyleSheetsAssigned=(e,t)=>{this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope(t)),{name:p.ADOPTED_STYLESHEET,data:e}))},this.onStyleSheetMutationProcessed=e=>{this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.STYLESHEET_MUTATION,data:e}))},this.cssProcessor=new Ke(this.currentWindow,this.nodeInfoManager,{onAdoptedStyleSheetDiscovered:this.onAdoptedStyleSheetDiscovered,onAdoptedStyleSheetMutationProcessed:this.onAdoptedStyleSheetMutationProcessed,onAdoptedStyleSheetsAssigned:this.onAdoptedStyleSheetsAssigned,onAssetDiscovered:this.onAssetDiscovered,onStyleSheetMutationProcessed:this.onStyleSheetMutationProcessed})}disable(){super.disable(),this.cssProcessor.disconnect()}enable(){super.enable(),this.cssProcessor.observe()}createDOMSnapshot(){const e=Object.create(null,{createDOMSnapshot:{get:()=>super.createDOMSnapshot}});return Dt(this,void 0,void 0,(function*(){const t=yield e.createDOMSnapshot.call(this);return this.cssProcessor.observe(this.currentWindow.document,t),t}))}onNodeAdded(e,t){super.onNodeAdded(e,t),(0,g.Ng)(e)&&this.cssProcessor.observe(e,t)}onNodeRemoved(e){super.onNodeRemoved(e),(0,g.Ng)(e)&&this.cssProcessor.disconnectShadowRoot(e)}}class jt extends Bt{constructor(e,t,...n){super(...n),this.parentMetadata=e,this.parentTimestamp=t,this.createSnapshotEvent=()=>{let e=this.parentTimestamp;return"number"==typeof e&&(e+=.001),Object.assign(Object.assign({},this.createEventEnvelope(e)),{name:p.DOM_SNAPSHOT,parentMetadata:this.parentMetadata})}}}class zt extends Bt{constructor(){super(...arguments),this.createSnapshotEvent=()=>Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.DOM_SNAPSHOT,parentMetadata:null}),this.attachPeriodicDOMSnapshotInterval=()=>{this.periodicDOMSnapshotInterval?i.R.warn("Periodic DOM snapshot interval is already attached"):this.periodicDOMSnapshotInterval=this.currentWindow.setInterval((()=>{i.R.debug("Creating periodic DOM snapshot"),this.createDOMSnapshot()}),this.taskConfig.periodicDOMSnapshotInterval)},this.detachPeriodicDOMSnapshotInterval=()=>{this.periodicDOMSnapshotInterval?(this.currentWindow.clearInterval(this.periodicDOMSnapshotInterval),this.periodicDOMSnapshotInterval=void 0):i.R.warn("Periodic DOM snapshot interval is not attached")}}disable(){super.disable(),this.detachPeriodicDOMSnapshotInterval()}enable(){super.enable(),this.attachPeriodicDOMSnapshotInterval()}}var Ut;!function(e){e.FULLSCREEN="fullscreen",e.POPOVER="popover",e.SCROLL="scroll",e.SELECTION="selection"}(Ut||(Ut={}));class Ft extends ot{constructor(){super(...arguments),this.lastEventType="None",this.handleSelection=()=>{let e=null;try{e=this.currentWindow.getSelection()}catch(e){if(t=this.currentWindow.getSelection,!/\[native code]/.test(t.toString()))return void this.disable();throw e}var t;if(e){if(void 0!==e.type){switch(e.type){case"Range":{if(!e.anchorNode||!e.focusNode)return void i.R.error("anchorNode or focusNode not defined",e);const t=Object.assign(Object.assign({},this.createEventEnvelope()),{name:Ut.SELECTION,data:{end:{offset:e.focusOffset,targetId:this.nodeInfoManager.getIdByNodeOrCreateNewOne(e.focusNode)},start:{offset:e.anchorOffset,targetId:this.nodeInfoManager.getIdByNodeOrCreateNewOne(e.anchorNode)}}});this.uploadEvent(t);break}case"None":case"Caret":if("Range"===this.lastEventType){const e=Object.assign(Object.assign({},this.createEventEnvelope()),{name:Ut.SELECTION,data:{targetId:this.nodeInfoManager.getIdByNode(this.currentWindow.document)}});this.uploadEvent(e)}break;default:i.R.error("Unexpected selectionchange selection type",e.type)}this.lastEventType=e.type}}else i.R.warn("window.getSelection() returned undefined")}}disable(){this.removeDocumentEventListener("selectionchange",this.handleSelection)}enable(){this.addDocumentEventListener("selectionchange",this.handleSelection),this.handleSelection()}}const Vt=e=>{let t=0,n=0,s=(0,Ge.u5)(e);for(;s;){const e=s.getBoundingClientRect();n+=e.top,t+=e.left,s=s.ownerDocument?(0,Ge.ni)(s.ownerDocument):null}return{clientX:t,clientY:n}};class _t extends ot{constructor(){super(...arguments),this.handleMouseMove=e=>{var t;const n=e.composedPath()[0],{clientX:s,clientY:o}=Vt(this.currentWindow),r={clientX:e.clientX+s,clientY:e.clientY+o};if((0,g.vq)(n)){const t=this.nodeInfoManager.getIdByNode(n),s=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.MOUSE_MOVE,data:Object.assign({elementX:e.offsetX,elementY:e.offsetY,targetId:t},r)});this.uploadEvent(s)}else if("Window"!==(null===(t=null==n?void 0:n.constructor)||void 0===t?void 0:t.name))return void i.R.warn("mousemove target is processed",n)}}disable(){this.removeDocumentEventListener("mousemove",this.handleMouseMove)}enable(){this.addDocumentEventListener("mousemove",this.handleMouseMove)}}class Qt extends ot{constructor(){super(...arguments),this.lastClickTimes=[],this.handleClick=e=>{const t=e.composedPath()[0],n=(0,g.Ll)(t)?this.nodeInfoManager.getIdByNode(t):void 0,{clientX:s,clientY:i}=Vt(this.currentWindow),o=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.CLICK,data:{clientX:e.clientX+s,clientY:e.clientY+i,elementX:e.offsetX,elementY:e.offsetY,targetId:n}});if(this.uploadEvent(o),this.lastClickTimes.length<4&&this.lastClickTimes.push(performance.now()),this.lastClickTimes.length>=4){if(this.lastClickTimes[3]-this.lastClickTimes[0]<=500&&void 0===this.rageClickTimeout){const t=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.RAGE_CLICK,data:{clientX:e.clientX+s,clientY:e.clientY+i,targetId:n}});this.uploadEvent(t),this.rageClickTimeout=setTimeout((()=>{this.rageClickTimeout=void 0}),5e3)}this.lastClickTimes=[]}}}disable(){this.removeEventListener("click",this.handleClick)}enable(){this.addEventListener("click",this.handleClick)}}class $t extends ot{constructor(){super(...arguments),this.listenerByShadowRoots=new Map,this.handleBlur=()=>{this.clearBlurTimeoutIfNeeded();const e=this.createEventEnvelope();this.blurTimeoutCallback=()=>this.sendBlurEvent(e),this.blurTimeoutId=setTimeout(this.blurTimeoutCallback)},this.handleFocus=e=>{if(!(0,et.Q)(e))return;const t=e.composedPath()[0];this.clearBlurTimeoutIfNeeded();try{if(void 0===t||t instanceof this.currentWindow.Window)return}catch(e){return void i.R.debug("Expected focus error happened",e)}if(!(0,g.vq)(t))return void i.R.warn("Focus target not found",e,t);const n=t.getRootNode();if(((0,g.Ng)(n)||(0,g.iX)(n))&&!this.listenerByShadowRoots.has(n))return n.addEventListener("focusin",this.handleFocus,!0),void this.listenerByShadowRoots.set(n,this.handleFocus);const s=this.nodeInfoManager.getIdByNodeOrCreateNewOne(t);this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.FOCUS,data:{targetId:s}}))}}disable(){this.removeEventListener("blur",this.handleBlur),this.removeEventListener("focus",this.handleFocus),this.listenerByShadowRoots.forEach(((e,t)=>{t.removeEventListener("focusin",e)})),this.listenerByShadowRoots.clear(),this.blurTimeoutId&&this.blurTimeoutCallback&&(this.blurTimeoutCallback(),this.clearBlurTimeoutIfNeeded())}enable(){this.addEventListener("blur",this.handleBlur),this.addEventListener("focus",this.handleFocus)}clearBlurTimeoutIfNeeded(){void 0!==this.blurTimeoutId&&(clearTimeout(this.blurTimeoutId),this.blurTimeoutId=void 0),this.blurTimeoutCallback&&(this.blurTimeoutCallback=void 0)}sendBlurEvent(e){this.uploadEvent(Object.assign(Object.assign({},e),{name:p.BLUR}))}}class Xt extends ot{constructor(){super(...arguments),this.handleFullscreenChangeEvent=()=>{const e=this.currentWindow.document.fullscreenElement;if(null===e)this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope()),{name:Ut.FULLSCREEN,data:{}}));else{const t=this.nodeInfoManager.getIdByNodeOrCreateNewOne(e);void 0!==t&&this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope()),{name:Ut.FULLSCREEN,data:{targetId:t}}))}}}disable(){this.removeDocumentEventListener("fullscreenchange",this.handleFullscreenChangeEvent)}enable(){this.addDocumentEventListener("fullscreenchange",this.handleFullscreenChangeEvent),this.currentWindow.document.fullscreenElement&&this.handleFullscreenChangeEvent()}}class Yt extends ot{constructor(){super(...arguments),this.prevStepById={},this.handleTouch=e=>{var t;const n=this.currentTouchMoveEvent;if(n){const s=this.createEventEnvelope().timestamp-n.timestamp,{clientX:i,clientY:o,timeElapsedSinceFirstTouch:r}=null!==(t=this.prevStepById[e.identifier])&&void 0!==t?t:{clientX:n.data.clientX,clientY:n.data.clientY,timeElapsedSinceFirstTouch:s},a=Math.round(s-r),d=this.getAbsoluteTouchPosition(e),c=d.clientX-i,u=d.clientY-o;void 0===n.data.steps[e.identifier]&&(n.data.steps[e.identifier]=[]),n.data.steps[e.identifier].push({deltaX:c,deltaY:u,timeDelta:a}),n.duration=s,this.prevStepById[e.identifier]={clientX:d.clientX,clientY:d.clientY,timeElapsedSinceFirstTouch:s}}else i.R.error("touch currentTouchMoveEvent is not yet created")},this.handleTouchEnd=()=>{this.currentTouchMoveEvent&&(this.uploadEvent(this.currentTouchMoveEvent),this.currentTouchMoveEvent=void 0,this.prevStepById={})},this.handleTouchMove=e=>{if(this.currentTouchMoveEvent)for(const t of Array.from(e.changedTouches))this.handleTouch(t);else this.handleTouchStart(e)},this.handleTouchStart=e=>{var t;let{target:n}=e;if(n&&(0,g.Ll)(n)&&!(0,g.vq)(n)&&(n=n.parentNode),n&&(0,g.vq)(n)){const t=e.touches[0],s=this.getAbsoluteTouchPosition(t),i=(0,g.Ll)(n)?this.nodeInfoManager.getIdByNode(n):void 0,o=n.getBoundingClientRect();this.currentTouchMoveEvent=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.TOUCH_MOVE,data:Object.assign({elementX:t.clientX-o.left,elementY:t.clientY-o.top,steps:{},targetId:i},s),duration:0});for(const t of Array.from(e.touches))this.handleTouch(t)}else{if(void 0===Node.ELEMENT_NODE)return;i.R.error("touchstart target is not Element",n,typeof n,null===(t=null==n?void 0:n.constructor)||void 0===t?void 0:t.name)}}}disable(){this.removeEventListener("touchend",this.handleTouchEnd),this.removeEventListener("touchmove",this.handleTouchMove),this.removeEventListener("touchstart",this.handleTouchStart)}enable(){this.addEventListener("touchend",this.handleTouchEnd),this.addEventListener("touchmove",this.handleTouchMove),this.addEventListener("touchstart",this.handleTouchStart)}getAbsoluteTouchPosition({clientX:e,clientY:t}){const{clientX:n,clientY:s}=Vt(this.currentWindow);return{clientX:e+n,clientY:t+s}}}var qt=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};class Ht extends ot{constructor(){super(...arguments),this.getDimensions=()=>qt(this,void 0,void 0,(function*(){let e=this.currentWindow.innerHeight,t=this.currentWindow.innerWidth;return[t,e].includes(0)?(0,o.wp)()?(i.R.debug("Resize dimension 0 on top window.",{height:e,width:t}),{height:e,width:t}):(yield new Promise((e=>setTimeout(e))),t=this.currentWindow.innerWidth,e=this.currentWindow.innerHeight,[t,e].includes(0)&&i.R.debug("Resize dimension 0 after setTimeout.",{height:e,width:t}),{height:e,width:t}):{height:e,width:t}})),this.handleResize=()=>{void 0===this.processResizeTimeoutId&&(this.processResizeTimeoutId=setTimeout((()=>{this.processResize(),this.processResizeTimeoutId=void 0}),50))},this.processResize=()=>{const{innerHeight:e,innerWidth:t,visualViewport:n}=this.currentWindow;n&&1!==n.scale&&e===n.height&&t===n.width||this.uploadResize()}}disable(){this.isTaskRunWithinMainWindow()&&this.removeEventListener("resize",this.handleResize)}enable(){this.isTaskRunWithinMainWindow()&&(this.uploadResize(),this.addEventListener("resize",this.handleResize))}uploadResize(){return qt(this,void 0,void 0,(function*(){const e=this.createEventEnvelope(),{height:t,width:n}=yield this.getDimensions();this.lastSentDimensions&&this.lastSentDimensions.height===t&&this.lastSentDimensions.width===n||(this.lastSentDimensions={height:t,width:n},this.uploadEvent(Object.assign(Object.assign({},e),{name:p.RESIZE,data:{height:t,width:n}})))}))}}class Kt extends ot{constructor(){super(...arguments),this.recordedShadowRoots=[],this.handleNodeAddedEvent=({node:e})=>{if(((0,g.Ng)(e)||(0,g.iX)(e))&&this.addShadowRootScrollListener(e),(0,g.vq)(e)){this.scrollManager.getPosition(e)&&this.handleScroll(e)}},this.handleNodeRemovedEvent=({node:e})=>{((0,g.Ng)(e)||(0,g.iX)(e))&&this.removeShadowRootScrollListener(e)},this.handleScrollEvent=e=>{if(!this.shouldProcessEvent(e))return;const{target:t}=e,n=t&&(0,g.vq)(t),s=t&&(0,g.Kc)(t)&&t.defaultView;n||s?this.handleScroll(t):i.R.debug("scroll event target is not element or document node")}}disable(){this.removeEventListener("scroll",this.handleScrollEvent),this.taskEmitter.removeEventListener("nodeAdded",this.handleNodeAddedEvent),this.taskEmitter.removeEventListener("nodeRemoved",this.handleNodeRemovedEvent),this.removeShadowRootScrollListeners()}enable(){this.taskEmitter.addEventListener("nodeAdded",this.handleNodeAddedEvent),this.taskEmitter.addEventListener("nodeRemoved",this.handleNodeRemovedEvent),this.addEventListener("scroll",this.handleScrollEvent),0===this.currentWindow.scrollX&&0===this.currentWindow.scrollY||this.handleScroll(this.currentWindow.document)}addShadowRootScrollListener(e){this.recordedShadowRoots.includes(e)||(e.addEventListener("scroll",this.handleScrollEvent,{capture:!0,passive:!0}),this.recordedShadowRoots.push(e))}handleScroll(e){let t;if((0,g.vq)(e))t={x:(s=e).scrollLeft,y:s.scrollTop},this.scrollManager.setPosition(e,t);else{if(!e.defaultView)return;t={x:(n=e.defaultView).scrollX,y:n.scrollY}}var n,s;const i=this.nodeInfoManager.getIdByNodeOrCreateNewOne(e),o=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.SCROLL,data:Object.assign(Object.assign({},t),{targetId:i})});this.uploadEvent(o)}removeShadowRootScrollListener(e){i.R.debug("Removing scroll on shadow root.",e),e.removeEventListener("scroll",this.handleScrollEvent,{capture:!0,passive:!0}),this.recordedShadowRoots=this.recordedShadowRoots.filter((t=>t!==e))}removeShadowRootScrollListeners(){for(const e of this.recordedShadowRoots)this.removeShadowRootScrollListener(e);this.recordedShadowRoots=[]}}var Gt=n(460);class Jt extends ot{constructor(){super(...arguments),this.idByAnimation=new WeakMap,this.isTaskStopped=!0,this.attachAnimateProxy=()=>{const e=this;try{f(this.currentWindow.Animation.prototype,"play",(t=>function(){const n=t();return e.processAnimationMethodCalls(this,"play"),n}))}catch(e){i.R.debug("Cannot apply `Animation.prototype.pause` proxy to Element.",e)}try{f(this.currentWindow.Animation.prototype,"pause",(t=>function(){const n=t();return e.processAnimationMethodCalls(this,"pause"),n}))}catch(e){i.R.debug("Cannot apply `Animation.prototype.pause` proxy to Element.",e)}try{f(this.currentWindow.Animation.prototype,"cancel",(t=>function(){const n=t();return e.processAnimationMethodCalls(this,"cancel"),n}))}catch(e){i.R.debug("Cannot apply `Animation.prototype.cancel` proxy to Element.",e)}},this.attachElementAnimateProxy=()=>{if(void 0===this.currentWindow.Element.prototype.animate)return void i.R.debug("Cannot apply Element.animate proxy. animate function is not defined.");const e=this;try{f(this.currentWindow.Element.prototype,"animate",(t=>function(n,s){const o=t(n,s),r=Ze.$();let a,d;if(e.idByAnimation.set(o,r),!e.isTaskStopped)try{a=JSON.parse((0,Gt.A)(n)),d=JSON.parse((0,Gt.A)(s));const t=e.nodeInfoManager.getIdByNodeOrCreateNewOne(this),i=e.createEventEnvelope(),o=Object.assign(Object.assign({},i),{name:p.ELEMENT_ANIMATE,data:{animationId:r,keyframes:a,options:d,targetId:t},timestamp:i.timestamp+5});e.uploadEvent(o)}catch(e){i.R.error("Cannot process animation.",e,a,d)}return o}))}catch(e){i.R.debug("Cannot apply `animate` proxy to Element.",e)}},this.processAlreadyExecutedAnimations=()=>{if(void 0===this.currentWindow.document.getAnimations)return void i.R.debug("Cannot processAlreadyExecutedAnimations. document.getAnimations() function is not defined.");const e=this.currentWindow.document.getAnimations().filter((e=>!e.constructor.name.startsWith("CSS")));for(const t of e)try{const e=t.effect;if(null===e||!(e instanceof this.currentWindow.KeyframeEffect)||null===e.target)continue;const n=Ze.$();this.idByAnimation.set(t,n);const s=this.nodeInfoManager.getIdByNodeOrCreateNewOne(e.target),i=JSON.parse((0,Gt.A)(e.getKeyframes())),o=JSON.parse((0,Gt.A)(e.getTiming())),r=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.ELEMENT_ANIMATE,data:{animationId:n,keyframes:i,options:o,targetId:s}});this.uploadEvent(r)}catch(e){i.R.error("Error happened during processing already executed animations.",e)}},this.processAnimationMethodCalls=(e,t)=>{if(!this.isTaskStopped)try{const n=this.idByAnimation.get(e);if(n){const e=this.createEventEnvelope(),s=Object.assign(Object.assign({},e),{name:p.ANIMATION,data:{animationId:n,methodName:t},timestamp:e.timestamp+5});this.uploadEvent(s)}else i.R.debug(`Animation not found in map. Calling Animation.${t}`)}catch(e){i.R.error(`Cannot process Animation.prototype.${t}.`,e)}}}disable(){this.isTaskStopped=!0}enable(){this.isTaskStopped=!1,this.processAlreadyExecutedAnimations(),this.attachElementAnimateProxy(),this.attachAnimateProxy()}}const Zt=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/];class en extends ot{constructor(){super(...arguments),this.throttleMap=new Map,this.getErrorMessage=e=>{var t,n,s;if("message"in e){if("string"==typeof e.message)return e.message;try{if(e.message)return null!==(t=JSON.stringify(e.message))&&void 0!==t?t:"non-serializable event.message - type "+typeof e.message}catch(e){}}if("reason"in e){if("string"==typeof e.reason)return e.reason;if("string"==typeof(null===(n=e.reason)||void 0===n?void 0:n.message))return`Unhandled promise error: ${e.reason.message}`;try{if(e.reason){const t=JSON.stringify(e.reason);return t?`Unhandled promise error: ${t}`:"non-serializable event.reason - type "+typeof e.reason}}catch(e){}}const o=e;if(null==o?void 0:o.target){if((0,g.vq)(o.target)){let e=null!==(s=o.target.getAttribute("src"))&&void 0!==s?s:"";return e=e.startsWith("blob://")?"blob://":e.startsWith("data:")?`${e.slice(0,47)}...`:e.slice(0,1e3),`Failed to load ${o.target.tagName} at "${e}".`}if(!this.currentWindow||this.currentWindow!==o.target)return i.R.debug("Received non element target.",o.target,typeof o.target,Object.getOwnPropertyNames(o.target)),null}return(0,Gt.A)(e)},this.processError=e=>{var t;const n=this.getErrorMessage(e);if(null===n)return;if(Zt.some((e=>n.match(e))))return;const s=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.ERROR,data:{colno:"colno"in e?e.colno:void 0,filename:"filename"in e?e.filename:void 0,lineno:"lineno"in e?e.lineno:void 0,message:n,source:null===(t=this.currentWindow.location)||void 0===t?void 0:t.origin,stack:"error"in e&&e.error&&Object.prototype.hasOwnProperty.call(e.error,"stack")?e.error.stack:void 0}});void 0===s.data.stack||"string"==typeof s.data.stack&&0!==s.data.stack.length||delete s.data.stack;const i=en.getEventHash(s);(!this.throttleMap.has(i)||performance.now()-(this.throttleMap.get(i)||0)>1e3)&&(this.uploadEvent(s),this.throttleMap.set(i,performance.now()))}}disable(){this.removeEventListener("error",this.processError),this.removeEventListener("unhandledrejection",this.processError)}enable(){this.addEventListener("error",this.processError),this.addEventListener("unhandledrejection",this.processError)}static getEventHash(e){const{colno:t,filename:n,lineno:s,message:i}=e.data;return JSON.stringify(["reason"in e,i,n,s,t])}}class tn extends ot{constructor(){super(...arguments),this.isMobileDevice=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[23]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test((navigator.userAgent||navigator.vendor||window.opera).slice(0,4)),this.lastVisualViewport={offsetLeft:0,offsetTop:0,scale:1},this.handleViewportChange=e=>{(0,et.Q)(e)&&void 0===this.timeoutId&&(this.timeoutId=setTimeout((()=>{this.processViewportChange(),this.timeoutId=void 0}),50))}}disable(){this.isTaskRunWithinMainWindow()&&this.currentWindow.visualViewport&&(this.currentWindow.visualViewport.removeEventListener("resize",this.handleViewportChange),this.currentWindow.visualViewport.removeEventListener("scroll",this.handleViewportChange))}enable(){this.isTaskRunWithinMainWindow()&&this.currentWindow.visualViewport&&(1===this.currentWindow.visualViewport.scale&&0===this.currentWindow.visualViewport.offsetLeft&&0===this.currentWindow.visualViewport.offsetTop||this.processViewportChange(),this.currentWindow.visualViewport.addEventListener("resize",this.handleViewportChange,{passive:!0}),this.currentWindow.visualViewport.addEventListener("scroll",this.handleViewportChange,{passive:!0}))}processViewportChange(){if(!this.currentWindow.visualViewport)return;const{offsetLeft:e,offsetTop:t}=this.currentWindow.visualViewport,{innerWidth:n,outerWidth:s}=this.currentWindow;let i=this.currentWindow.visualViewport.scale;if(this.isMobileDevice){!(1===i&&n>s)&&(i*=n/s)}const o={offsetLeft:this.lastVisualViewport.offsetLeft===e?void 0:e,offsetTop:this.lastVisualViewport.offsetTop===t?void 0:t,scale:this.lastVisualViewport.scale===i?void 0:i};if(this.lastVisualViewport={offsetLeft:e,offsetTop:t,scale:i},Object.values(o).every((e=>void 0===e)))return;const r=Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.VISUAL_VIEWPORT,data:o});this.uploadEvent(r)}}var nn=n(8194);class sn extends ot{constructor(e,t,n){super(e,t),this.urlSpansQueue=n,this.handleBrumUrlSpan=e=>{const t=this.createEventEnvelope();t.timestamp=(0,tt.JU)(e.startTime);const n=Object.assign(Object.assign({},t),{name:p.URL_SPAN,data:{name:e.name,endTime:e.endTime,pageUrl:e.attributes[nn.vSt],spanId:e.spanContext().spanId,startTime:e.startTime,traceId:e.spanContext().traceId},timestamp:t.timestamp});this.uploadEvent(n)}}disable(){this.isTaskRunWithinMainWindow()&&this.urlSpansQueue.unsubscribe()}enable(){this.isTaskRunWithinMainWindow()&&this.urlSpansQueue.subscribe((e=>this.handleBrumUrlSpan(e)))}}class on extends ot{constructor(){super(...arguments),this.isTaskStopped=!1,this.applyDescriptorProxyToInputElement=(e,t)=>{const{handleInputForTarget:n}=this;m(Object.getPrototypeOf(e),t,(function(e){return Object.assign(Object.assign({},e),{set(s){var o;null===(o=e.set)||void 0===o||o.apply(this,[s]);try{n(this,"proxy")}catch(e){i.R.error(`Error happened in input proxy setter - ${t}.`,e)}}})}))},this.attachInputSetterProxy=(e,t)=>{t.forEach((t=>{try{this.applyDescriptorProxyToInputElement(e,t)}catch(e){i.R.debug(`Cannot apply HTMLInputElement.prototype.${t} proxy.`,e)}}))},this.handleBlur=()=>{this.currentTypingEvent&&(this.uploadEvent(this.currentTypingEvent),this.currentTypingEvent=void 0)},this.handleChange=e=>{this.handleEvent(e,"change")},this.handleEvent=(e,t)=>{const n=e.composedPath()[0];this.handleInputForTarget(n,t)},this.handleInput=e=>{this.handleEvent(e,"input")},this.handleInputForTarget=(e,t)=>{if(!this.isTaskStopped)return(0,g.vq)(e)?this.isExpectedElement(e)?void(this.shouldProcessTarget(e)&&this.processTarget(e,t)):(i.R.debug("Input target is not input/select/textarea",e),!1):(i.R.debug("Target is not an element."),!1)},this.isExpectedElement=e=>(0,g.B6)(e)||(0,g.Jp)(e)||(0,g.j1)(e),this.shouldProcessTarget=e=>!this.privacyManager.isNodeExcluded(e)&&e.isConnected}disable(){this.isTaskStopped=!0,this.removeDocumentEventListener("blur",this.handleBlur),this.removeDocumentEventListener("change",this.handleChange),this.removeDocumentEventListener("input",this.handleInput)}enable(){this.addDocumentEventListener("blur",this.handleBlur),this.addDocumentEventListener("change",this.handleChange),this.addDocumentEventListener("input",this.handleInput),this.attachInputSetterProxy(this.currentWindow.document.createElement("input"),["value","checked"]),this.attachInputSetterProxy(this.currentWindow.document.createElement("textarea"),["value"])}createInputEvent(e){return Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.INPUT,data:e})}processSensitiveInput(e,t){this.currentTypingEvent||this.uploadEvent(this.createInputEvent({isTyping:!0,source:t,targetId:e})),this.currentTypingEvent=this.createInputEvent({isTyping:!1,source:t,targetId:e})}processTarget(e,t){let n=e.value;const s=this.nodeInfoManager.getIdByNodeOrCreateNewOne(e);if(this.privacyManager.shouldMaskInputNode(e)||this.privacyManager.isPasswordInput(e))return void this.processSensitiveInput(s,t);["checkbox","radio"].includes(e.type)&&(0,g.B6)(e)&&(n=String(e.checked));const i=this.createInputEvent({source:t,targetId:s,value:n});this.uploadEvent(i)}}class rn extends ot{constructor(){super(...arguments),this.handleNodeAddedEvent=({node:e})=>{((0,g.X)(e)||e.parentNode&&(0,g.X)(e.parentNode))&&this.handleTitleChange()},this.handleTitleChange=()=>{this.lastTitle!==document.title&&(this.lastTitle=document.title,this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.TITLE,data:{title:this.currentWindow.document.title}})))}}disable(){this.taskEmitter.removeEventListener("nodeAdded",this.handleNodeAddedEvent)}enable(){this.handleTitleChange(),this.taskEmitter.addEventListener("nodeAdded",this.handleNodeAddedEvent)}}class an extends ot{constructor(){super(...arguments),this.sendPulseEvent=e=>{this.uploadEvent(Object.assign(Object.assign({},this.createEventEnvelope()),{name:p.PULSE,data:{documentVisibilityState:document.visibilityState,source:e}}))}}disable(){this.sendPulseEvent("disable"),this.removePulseEventInterval()}enable(){this.pulseInterval||this.attachPulseEventInterval(),this.sendPulseEvent("enable")}attachPulseEventInterval(){this.pulseInterval=setInterval((()=>{this.sendPulseEvent("interval")}),15e4)}removePulseEventInterval(){this.pulseInterval&&(clearInterval(this.pulseInterval),this.pulseInterval=void 0)}}class dn extends ot{constructor(){super(...arguments),this.isTaskStopped=!1,this.handleToggle=({newState:e,target:t})=>{if(this.isTaskStopped)return;if(!t||!(0,g.sb)(t))return void i.R.debug("Target is not an HTML element.");if(!t.popover)return void i.R.debug("Target is not popover element, could be `details` element that supports `open` attribute.",t);const n=this.nodeInfoManager.getIdByNodeOrCreateNewOne(t),s=this.createPopoverEvent({newState:e,targetId:n});this.uploadEvent(s)}}disable(){this.isTaskStopped=!0,this.removeDocumentEventListener("toggle",this.handleToggle)}enable(){this.addDocumentEventListener("toggle",this.handleToggle)}createPopoverEvent(e){return Object.assign(Object.assign({},this.createEventEnvelope()),{name:Ut.POPOVER,data:e})}}var cn=n(3632),un=n(6022),ln=n(9015);class hn{constructor(){this.idByWindow=new WeakMap}getWindowId(e){const t=this.idByWindow.get(e);if(!t)throw new Error("Window ID not found in ChildWindowIdManager");return t}setWindowId(e,t){this.idByWindow.set(e,t)}}class pn{constructor(){this.idByWindow=new WeakMap,this.lastUsedWindowId=0}getWindowId(e){const t=this.idByWindow.get(e);return t||(this.lastUsedWindowId+=1,this.idByWindow.set(e,this.lastUsedWindowId),this.lastUsedWindowId)}}var vn=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};class gn{constructor(e){if(this.services=e,this.receiveWindowIdFromParent=e=>vn(this,void 0,void 0,(function*(){if(this.windowIdManager instanceof hn){const t=window.parent;this.services.postMessageService.sendEventToSource(Object.assign(Object.assign({},this.services.postMessageService.createPostMessageEvent()),{name:Je.g4.GET_WINDOW_ID}),t);const n=yield this.services.postMessageService.waitForEventFromSource(Je.g4.WINDOW_ID,t);this.windowIdManager.setWindowId(e,n.windowId)}else i.R.error("ParentWindowIdManager is not expected in child window.")})),!un.C.isReady)throw new Error("ScriptModeService is not ready");this.windowIdManager=un.C.isCrossOriginIframeMode?new hn:new pn,un.C.isNormalMode&&this.attachPostMessageListener()}getWindowId(e){return this.windowIdManager.getWindowId(e)}attachPostMessageListener(){this.services.postMessageService.addPostMessageEventListener(Je.g4.GET_WINDOW_ID,((e,t)=>vn(this,void 0,void 0,(function*(){this.windowIdManager instanceof pn?this.services.postMessageService.sendEventToSource(Object.assign(Object.assign({},this.services.postMessageService.createPostMessageEvent()),{name:Je.g4.WINDOW_ID,windowId:this.windowIdManager.getWindowId(t)}),t):i.R.error("ChildWindowIdManager is not expected in top window.")}))))}}const fn=(0,a.i)("node-info-manager");class mn{constructor(){this.infoByNodes=new WeakMap,this.lastUsedNodeId=0,this.loadListenersByIframeNodes=new Map,this.deleteLoadListenerForIframe=e=>{const t=this.loadListenersByIframeNodes.get(e);void 0!==t&&(fn.debug(`Deleting load listener for iframe id ${this.getIdByNode(e)}`),e.removeEventListener("load",t,!0),this.loadListenersByIframeNodes.delete(e))},this.getLoadListenerForIframe=e=>this.loadListenersByIframeNodes.get(e)}deleteNodeInfo(e){(0,g.bK)(e)&&this.deleteLoadListenerForIframe(e),this.infoByNodes.delete(e)}getIdByNode(e){const t=this.infoByNodes.get(e);if(void 0!==t)return t.id}getIdByNodeOrCreateNewOne(e){const t=this.infoByNodes.get(e);return void 0===t?(this.lastUsedNodeId+=1,this.setNodeInfo(e,{id:this.lastUsedNodeId,isMasked:!1,isRecorded:!1}),this.lastUsedNodeId):t.id}getNodeInfo(e){return this.infoByNodes.get(e)}setLoadListenerForIframe(e,t){e.addEventListener("load",t,!0),void 0===this.loadListenersByIframeNodes.get(e)&&(fn.debug(`Setting load listener for iframe id ${this.getIdByNode(e)}`),this.loadListenersByIframeNodes.set(e,t))}setNodeInfo(e,t){this.infoByNodes.set(e,t)}}const Sn=["card","credit","expiry","cvv","cvc"],yn=["cc-name","cc-given-name","cc-additional-name","cc-family-name","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc","cc-type"],En=new Set(["file","password"]);class wn{constructor(e){this.config=e,this.privacyInfoByNode=new WeakMap,this.deleteNodePrivacyInfo=e=>{this.privacyInfoByNode.delete(e)},this.getSensitivityRules=()=>this.config.apiConfig.sessionReplay.sensitivityRules,this.isCreditCardInput=e=>(e=>{var t;const n=(null!==(t=e.getAttribute("autocomplete"))&&void 0!==t?t:"").toLowerCase();return!(!n||!yn.some((e=>n.includes(e))))||Array.from(e.attributes).filter((e=>"value"!==e.name)).flatMap((e=>[e.name,e.value])).some((e=>Sn.some((t=>e.toLowerCase().includes(t)))))})(e),this.isNodeExcluded=e=>"exclude"===this.retrieveNodePrivacyInfo(e).sensitivityRuleType,this.isNodeMasked=e=>{const t=this.retrieveNodePrivacyInfo(e);return["mask","exclude"].includes(t.sensitivityRuleType)},this.isNodeUnmasked=e=>"unmask"===this.retrieveNodePrivacyInfo(e).sensitivityRuleType,this.isPasswordInput=e=>this.retrieveNodePrivacyInfo(e).isPasswordInput,this.isSensitiveInput=e=>this.isPasswordInput(e)||(0,g.B6)(e)&&this.isCreditCardInput(e)||En.has(e.type),this.recomputeNodePrivacyInfoForNodeAndItsSubtree=e=>{for(const t of wt.kK(e,{useNativeTreeWalker:this.config.apiConfig.aura}))this.retrieveAndStoreNodePrivacyInfo(t)},this.retrieveAndStoreNodePrivacyInfo=e=>{const t=wt.$4(e),n=t?this.privacyInfoByNode.get(t):null,s=(0,Mt.d0)(e,this.getSensitivityRules());let i;if(n)i=(0,Mt.TD)(n,s);else{i=Object.assign({},s);for(const t of wt.HS(e)){const e=(0,Mt.d0)(t,this.getSensitivityRules());i=(0,Mt.TD)(e,i)}}const o=Object.assign(Object.assign({},i),{parent:t}),r=this.privacyInfoByNode.get(e);return r&&r.isPasswordInput&&(o.isPasswordInput=!0),this.privacyInfoByNode.set(e,o),o},this.retrieveNodePrivacyInfo=e=>{const t=this.privacyInfoByNode.get(e);return void 0===t||wt.$4(e)!==t.parent?this.retrieveAndStoreNodePrivacyInfo(e):t},this.setIsPasswordInput=e=>{const t=this.retrieveNodePrivacyInfo(e);this.privacyInfoByNode.set(e,Object.assign(Object.assign({},t),{isPasswordInput:!0,parent:wt.$4(e)}))},this.shouldMaskInputNode=e=>this.isNodeMasked(e)||this.isMaskAllInputsEnabled()&&!this.isNodeUnmasked(e)||(0,g.oq)(e)&&this.isSensitiveInput(e),this.shouldMaskTextNode=e=>this.isNodeMasked(e)||this.isMaskAllTextEnabled()&&!this.isNodeUnmasked(e),this.isMaskAllInputsEnabled=()=>this.config.apiConfig.sessionReplay.maskAllInputs,this.isMaskAllTextEnabled=()=>this.config.apiConfig.sessionReplay.maskAllText}}var bn=function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};const In=(0,a.i)("ReplayInstrumentation");class Pn extends cn.O{get logger(){return this.loggerProvider.getLogger("session-replay")}constructor(e){super("@client/modules/replay-instrumentation","0.0.1",e),this.config=e,this.assetsQueue=[],this.eventsQueue=[],this.isInstrumentationEnabled=!1,this.recordTasksByWindow=new Map,this.cacheAsset=e=>{this.logger.emit({attributes:{"event.domain":"brum","event.name":d.FE,instrumentation_state:this.isInstrumentationEnabled?"enabled":"disabled",time_unix_nano:1e6*e.timestamp,url:e.url}}),this.assetsQueue.push(e),In.debug("Cache asset",e)},this.receiveWindowIdInCrossOriginIframe=e=>bn(this,void 0,void 0,(function*(){un.C.isCrossOriginIframeMode&&(yield this.instrumentationScopedManagers.windowIdManager.receiveWindowIdFromParent(e))})),this.startRecordingIframeWindow=(e,t,n)=>bn(this,void 0,void 0,(function*(){if(!this.config.appConfig.apiConfig.sessionReplay.iframes)return void In.warn("Iframes are disabled");if(!(0,o.VP)(e))return;this.recordTasksByWindow.get(e)&&this.stopRecordingWindow(e),In.debug("Start recording iframe",e);const s=this.createTaskConfig();yield this.receiveWindowIdInCrossOriginIframe(e),this.startRecordTasks(e,[new jt(t,n,e,s,this.startRecordingIframeWindow),...this.createRecordTasks(e,s)])})),this.startRecordingMainWindow=()=>bn(this,void 0,void 0,(function*(){const e=this.createTaskConfig(),t=window;yield this.receiveWindowIdInCrossOriginIframe(t),this.startRecordTasks(t,[un.C.isCrossOriginIframeMode&&this.config.parentMetadata?new jt(this.config.parentMetadata,void 0,t,e,this.startRecordingIframeWindow):new zt(t,e,this.startRecordingIframeWindow),...this.createRecordTasks(t,e)])})),this.stopRecordingWindow=e=>{In.debug("Stop recording window",e);const t=this.recordTasksByWindow.get(e);t&&(t.forEach((e=>e.disable())),this.recordTasksByWindow.delete(e))},this.uploadEvent=e=>{this.dataSendingIntervalId?(this.eventsQueue.push(e),In.debugGroup(`Upload - ${e.name} event`,e)):In.warn("There is no data sending interval. Event will not be sent.",e)},this.uploadProcessedAsset=e=>{this.assetsQueue.push(e),In.debug("Uploading asset",e)},this.instrumentationScopedManagers=(({services:e})=>({windowIdManager:new gn({postMessageService:e.postMessageService})}))({services:{postMessageService:e.services.postMessageService}})}disable(){this.isInstrumentationEnabled=!1;for(const e of this.recordTasksByWindow.keys())this.stopRecordingWindow(e),this.recordTasksByWindow.delete(e);this.emitLogRecordWithAllEvents(),this.addOrResetDataSendingInterval(500),v.postTask("ReplayInstrumentation.disable",(()=>{this.removeDataSendingInterval()}))}enable(){this.isInstrumentationEnabled=!0,this.addOrResetDataSendingInterval(this.config.appConfig.apiConfig.exportInterval),this.startRecordingMainWindow()}init(){}addOrResetDataSendingInterval(e){void 0!==this.dataSendingIntervalId&&this.removeDataSendingInterval(),this.dataSendingIntervalId=setInterval((()=>this.emitLogRecordWithAllEvents()),e)}createRecordTasks(e,t){return[new Ft(e,t),new _t(e,t),new Qt(e,t),new $t(e,t),new Xt(e,t),new Yt(e,t),new Ht(e,t),new Kt(e,t),new Jt(e,t),new en(e,t),new tn(e,t),new sn(e,t,this.config.urlSpansQueue),new on(e,t),new rn(e,t),new an(e,t),new dn(e,t)]}createTaskConfig(){return{cacheAsset:this.cacheAsset,exportForTests:this.config.appConfig.apiConfig.exportForTests,instrumentationScopedManagers:this.instrumentationScopedManagers,isDebug:this.config.appConfig.apiConfig.exportersForDebug,moduleScopedManagers:this.config.moduleScopedManagers,originalFetch:this.config.originalFetch,packAssets:this.config.appConfig.apiConfig.sessionReplay.packAssets,periodicDOMSnapshotInterval:this.config.appConfig.apiConfig.sessionReplay.periodicDOMSnapshotInterval,postMessageService:this.config.services.postMessageService,taskEmitter:new c,timeService:this.config.services.timeService,uploadEvent:this.uploadEvent,uploadProcessedAsset:this.uploadProcessedAsset,uploadTimeout:5e3,useNativeTreeWalker:this.config.appConfig.apiConfig.aura,windowScopedManagers:(e=this.config.appConfig,{nodeInfo:new mn,privacy:new wn(e)})};var e}emitLogRecordWithAllEvents(){if(0===this.eventsQueue.length&&0===this.assetsQueue.length)return;const e=this.eventsQueue;this.eventsQueue=[];const t=this.assetsQueue;this.assetsQueue=[];const n={events:e,meta:{assets:t,"browser.instance.id":ln.$.id,chunkIndex:d.r9},version:"0.0.1"},s={attributes:{"event.domain":"brum","event.name":d.HX,instrumentation_state:this.isInstrumentationEnabled?"enabled":"disabled"},body:JSON.stringify(n)};this.logger.emit(s),In.debug("Event pushed to OTEL logs",s)}removeDataSendingInterval(){void 0!==this.dataSendingIntervalId&&clearInterval(this.dataSendingIntervalId),this.dataSendingIntervalId=void 0}startRecordTasks(e,t){this.recordTasksByWindow.set(e,t),t.forEach((e=>e.enable()))}}class Cn{constructor(){this.scrollPositionsByElement=new WeakMap,this.getPosition=e=>this.scrollPositionsByElement.get(e),this.setPosition=(e,t)=>{this.scrollPositionsByElement.set(e,t)}}}class Rn extends r.n{constructor(e,t,n,s,i,o){super(e,t,n,s,i),this.services=o,this.isStarted=!1,this.moduleScopedManagers={scroll:new Cn}}start(e){if(this.isStarted)throw new Error("ReplayModule is already started. Start is not needed.");i.R.debug("ReplayModule.start()"+((0,o.RT)()?" - iframe":""),this.config,document.visibilityState),this.isStarted=!0,this.instrumentations=[new Pn(Object.assign(Object.assign({enabled:!1},this.providers),{appConfig:this.config,moduleScopedManagers:this.moduleScopedManagers,originalFetch:this.moduleConfig.originalFetch,parentMetadata:e,services:this.services,session:this.session,urlSpansQueue:this.urlSpansQueue}))],(0,s.R)({instrumentations:this.instrumentations,tracerProvider:this.providers.webTracerProvider})}stop(){if(!this.isStarted)throw new Error("ReplayModule is not started. Stop is not needed.");i.R.debug("ReplayModule.stop()"),this.isStarted=!1,this.instrumentations&&(this.instrumentations.forEach((e=>e.disable())),this.instrumentations=void 0)}}}}]);
//# sourceMappingURL=replay.389186a76c835244f991.adrum.js.map